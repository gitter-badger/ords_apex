!function(widget,util,server,$){widget.cssCalendar=function(pRegionId,pOptions){function _init(){gOptions=$.extend({enableDragAndDrop:!1,pageItems:""},pOptions),gRegion$=$("#"+util.escapeCSS(pRegionId),apex.gPageContext$),gCalendar$=$("#"+util.escapeCSS(pRegionId+"_calendar"),apex.gPageContext$),gLocale$=$.fullCalendar.defaults,gOptions=$.extend(gOptions,gLocale$),0===gRegion$.length&&(gRegion$=gCalendar$.wrap('<div id="'+pRegionId+'"></div>')),gOptions.timeFormat={month:"",list:"",agenda:""},"12"===gOptions.timeFormatType?(gOptions.axisFormat="h(:mm)a",gOptions.timeFormat={month:"",list:"h:mm a",agenda:""}):"24"===gOptions.timeFormatType&&(gOptions.axisFormat="H:mm",gOptions.timeFormat={month:"",list:"H:mm",agenda:""}),gAllDay=!1,(gOptions.apexWebLink||gOptions.googleId)&&(gAllDay=!0),gOptions.columnFormat={month:"dddd",week:"ddd M/D",day:"dddd"},gOptions.enableDragAndDrop?gOptions.enableResizing?(gOptions.eventStartEditable=!0,gOptions.eventDurationEditable=!0,gOptions.editable=!0):(gOptions.editable=!0,gOptions.eventStartEditable=!0,gOptions.eventDurationEditable=!1):(gOptions.eventStartEditable=!1,gOptions.eventDurationEditable=!1,gOptions.editable=!1),gCalStorage=apex.storage.getScopedSessionStorage({prefix:"ORA_WWV_apex.Calendar",useAppId:!0,usePageId:!0,regionId:pRegionId}),gLastView=gCalStorage.getItem("lastview");var currentDate=moment();if(gLastView)try{gLastView=$.parseJSON(gLastView),null!==gLastView&&moment(gLastView.viewStartDate).isValid()&&(currentDate=gLastView.viewStartDate)}catch(ex){currentDate=moment(),gLastView=null}gOptions.isMobile?server.plugin(gOptions.ajaxIdentifier,{x01:"MON_SAME",x02:gOptions.startDate,x03:gOptions.endDate,x09:gOptions.curDate,pageItems:gOptions.pageItems},{dataType:"html",refreshObject:gRegion$,success:function(pData){apex.jQuery(gRegion$,apex.gPageContext$).html(pData).trigger("create")},error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert(pErrorThrown)}}):gCalendar$.fullCalendar({theme:!0,header:JSON.parse(gOptions.calendarHeader),monthNames:gOptions.monthNames,monthNamesShort:gOptions.monthNamesShort,dayNames:gOptions.dayNames,dayNamesShort:gOptions.dayNamesShort,buttonText:gOptions.buttonText,timeFormat:gOptions.timeFormat,columnFormat:gOptions.columnFormat,titleFormat:gOptions.titleFormat,axisFormat:gOptions.axisFormat,firstDay:gOptions.firstDayOfWeek,isRTL:gOptions.isRTL,editable:gOptions.editable,eventStartEditable:gOptions.eventStartEditable,eventDurationEditable:gOptions.eventDurationEditable,nextDayThreshold:"00:00:00",weekends:gOptions.weekEnds,eventLimit:parseInt(gOptions.eventLimit),defaultTimedEventDuration:"01:00:00",aspectRatio:2.6,scrollTime:lPadTime(gOptions.startingHour),minHour:gOptions.minHour,maxHour:gOptions.maxHour,allDaySlot:gAllDay,allDayDefault:gAllDay,googleCalendarApiKey:gOptions.googleApiKey,defaultDate:currentDate,eventSources:[{events:_getEvents,editable:gOptions.editable,startEditable:gOptions.eventStartEditable,durationEditable:gOptions.eventDurationEditable},{googleCalendarId:gOptions.googleId,className:"fc-apex-events-gcal"},{events:_getWebserviceEvents,editable:!1,className:"fc-apex-events-webservice"}],eventResize:_eventResize,eventDrop:_eventDrop,dayClick:_dayClick,eventClick:_eventClick,eventMouseover:_eventMouseOver,eventMouseout:_eventMouseOut,windowResize:_windowResize,slotEventOverlap:!1,defaultEventMinutes:60,selectable:!0,selectHelper:!0,fixedWeekCount:!1,select:_calSelect,viewRender:function(view){gCalStorage.setItem("lastview",JSON.stringify({viewType:view.name,viewStartDate:view.intervalStart}))},eventRender:function(event,element){gOptions.escapeOutput&&(element.find("span.fc-title").html(element.find("span.fc-title").text()),element.find("div.fc-title").html(element.find("div.fc-title").text()),element.find("div.fc-eventlist-title").html(element.find("div.fc-eventlist-title").text()),element.find("span.fc-apex-tooltip-desc").html(element.find("span.fc-apex-tooltip-desc").text()),element.find("div.fc-eventlist-desc").html(element.find("div.fc-eventlist-desc").text()))},eventAfterAllRender:function(){}}),gRegion$.on("apexrefresh",function(){_refresh()}),gCalendar$.on("apexafterclosedialog",function(){_refresh()}),gDialog$=$("div.fc-apex-dialog-invitation").dialog({autoOpen:!1,height:450,width:650,modal:!0,buttons:{"Send Email":sendingEmail,Cancel:function(){gDialog$.dialog("close")}},close:function(){}});gDialog$.find("form").on("submit",function(event){event.preventDefault(),sendingEmail()});null!==gLastView&&moment(gLastView.viewStartDate).isValid()&&("month"===gLastView.viewType||"agendaWeek"===gLastView.viewType||"agendaDay"===gLastView.viewType||"list"===gLastView.viewType)&&gCalendar$.fullCalendar("changeView",gLastView.viewType)}function sendingEmail(){var lEvent=$(this).data("event");widget.cssCalendar.sendEmail("S",lEvent),gDialog$.dialog("close")}function lPadTime(pTime){return 9>=pTime?"0"+pTime+":00:00":""+pTime+":00:00"}function _refresh(){gCalendar$.fullCalendar("refetchEvents")}function _convertDateToString(pDate){function lPad(pValue){return 9>=pValue?"0"+pValue:""+pValue}return"date"===$.type(pDate)?pDate.getFullYear()+lPad(pDate.getMonth()+1)+lPad(pDate.getDate())+lPad(pDate.getHours())+lPad(pDate.getMinutes())+lPad(pDate.getSeconds()):pDate}function _getEvents(pStart,pEnd,pTimezone,pCallback){server.plugin(gOptions.ajaxIdentifier,{x01:"GET",x02:_convertDateToString(pStart.toDate()),x03:_convertDateToString(pEnd.toDate()),pageItems:gOptions.pageItems},{refreshObject:gRegion$,success:function(pData){pCallback(pData)}})}function _getWebserviceEvents(pStart,pEnd,pTimezone,pCallback){gOptions.apexWebLink?$.ajax({url:gOptions.apexWebLink,dataType:"json",jsonp:!1,success:function(data){pCallback(data.items)}}):pCallback({})}function _windowResize(view){var lWidth=$(window).width();"month"===view.name?$(window).width()<700&&(gCalendar$.fullCalendar("changeView","list"),gCalendar$.fullCalendar("option","aspectRatio",1)):"list"===view.name&&lWidth>700&&gCalendar$.fullCalendar("changeView","month")}function _changeEvent(pEvent,pDurationDelta,pRevertFunction){server.plugin(gOptions.ajaxIdentifier,{x01:"CHANGE",x02:pEvent.start.format("YYYYMMDDHHmmss"),x03:null!==pEvent.end?pEvent.end.format("YYYYMMDDHHmmss"):null,x04:pEvent.id,x05:pEvent.checksum,pageItems:gOptions.pageItems},{refreshObject:gRegion$,error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert(pErrorThrown),pRevertFunction()}})}function _eventDrop(pEvent,pDurationDelta,pRevertFunction){_changeEvent(pEvent,pDurationDelta,pRevertFunction)}function _eventResize(pEvent,pDurationDelta,pRevertFunction){_changeEvent(pEvent,pDurationDelta,pRevertFunction)}function _dayClick(){}function _eventClick(pEvent,pJsEvent){var eDisplay='<span class="fc-apex-dialog-title">'+pEvent.title+"</span>";return eDisplay=eDisplay+'<span class="fc-apex-dialog-date">'+pEvent.start.format(pEvent.allDay?"lll":"ll")+"</span>",pEvent.end&&(eDisplay=eDisplay+'<span class="fc-apex-dialog-date">'+pEvent.end.format(pEvent.allDay?"lll":"ll")+"</span>"),pEvent.description&&(eDisplay=eDisplay+'<span class="fc-apex-dialog-desc">'+htmlEscape(pEvent.description)+"</span>"),"a-Icon icon-region-native-calendar u-pullRight"==pJsEvent.target.className?($("div.fc-apex-dialog-details").html(eDisplay),gDialog$.data("event",pEvent).dialog("open"),!1):(pEvent.url&&apex.navigation.redirect(pEvent.url),!1)}function htmlEscape(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function _eventMouseOver(pEvent){var dateDisplay;if(gOptions.mouseHoverOver){dateDisplay=pEvent.end?pEvent.allDay?$.fullCalendar.formatRange(pEvent.start,pEvent.end,"ll"):$.fullCalendar.formatRange(pEvent.start,pEvent.end,"lll"):pEvent.start.format(pEvent.allDay?"ll":"lll");var tooltip='<div class="fc-apex-tooltip"> <span class="fc-apex-tooltip-title">'+pEvent.title+"</span>";pEvent.description&&(tooltip=tooltip+'<span class="fc-apex-tooltip-desc">'+htmlEscape(pEvent.description)+"</span>"),tooltip=tooltip+'<span class="fc-apex-tooltip-date">'+dateDisplay+"</span>",tooltip+="</div>",gCalendar$.append(tooltip),$(this).mouseover(function(){$(this).css("z-index",1e4),$(".fc-apex-tooltip").fadeIn("500"),$(".fc-apex-tooltip").fadeTo("10",1.9)}).mousemove(function(e){var tooltip$=$(".fc-apex-tooltip"),suggestedLeft=e.clientX+10,realLeft=Math.min($(window).width()-tooltip$.width()-40,suggestedLeft);tooltip$.css("left",realLeft);var suggestedTop=e.clientY+10,realTop=suggestedTop;suggestedTop+tooltip$.height()>$(window).height()&&(realTop=e.clientY-tooltip$.height()-30),tooltip$.css("top",realTop)})}}function _eventMouseOut(){$(this).css("z-index",8),$(".fc-apex-tooltip").remove()}function _calSelect(pStart,pEnd){var cLink,view=gCalendar$.fullCalendar("getView");"month"===view.name&&pEnd.subtract(1,"minutes"),gOptions.createLink&&(cLink=gOptions.createLink,cLink=cLink.replace("~APEX_NEW_START_DATE~",pStart.format(gOptions.appDateFormat)),cLink=cLink.replace("~APEX_NEW_END_DATE~",pEnd.format(gOptions.appDateFormat)),apex.navigation.redirect(cLink)),gCalendar$.fullCalendar("unselect"),gCalendar$.fullCalendar("rerenderEvent")}var gOptions,gRegion$,gCalendar$,gLocale$,gAllDay,gDialog$,gCalStorage,gLastView;_init(),widget.cssCalendar.download=function(pFormat){var view=gCalendar$.fullCalendar("getView"),lUrl=server.pluginUrl(gOptions.ajaxIdentifier,{x01:"DOWNLOAD",x02:_convertDateToString(view.start.toDate()),x03:_convertDateToString(view.end.toDate()),x06:view.name,x07:view.title,x10:pFormat,pageItems:gOptions.pageItems},{error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert("Error : "+pErrorThrown)}}),lWindows=open(lUrl);lWindows.focus()},widget.cssCalendar.sendEmail=function(pType,pEvent){var view;"S"===pType?server.plugin(gOptions.ajaxIdentifier,{x01:"SEND",x02:pEvent.start.format("YYYYMMDDHHmmss"),x02:pEvent.start.format("YYYYMMDDHHmmss"),pageItems:gOptions.pageItems},{dataType:"html",refreshObject:gRegion$,error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert(pErrorThrown)}}):(view=gCalendar$.fullCalendar("getView"),server.pluginUrl(gOptions.ajaxIdentifier,{x01:"SEND",x02:_convertDateToString(view.start.toDate()),x03:_convertDateToString(view.end.toDate()),x06:view.name,x07:view.title,x09:pType,pageItems:gOptions.pageItems},{error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert("Error : "+pErrorThrown)}}))},widget.cssCalendar.mobileDayTap=function(pRegionId,pThis){var lDate=apex.jQuery(pThis).data("date"),lDetails$=apex.jQuery("#calendar_day_details_"+pRegionId,apex.gPageContext$);apex.jQuery(".m-Calendar-day").removeClass("is-active"),apex.jQuery(pThis).addClass("is-active"),apex.widget.cssCalendar.getDayData(pRegionId,lDate,{clear:function(){lDetails$.empty()},success:function(pData){lDetails$.html(pData)}})},widget.cssCalendar.mobileMonthLoad=function(pRegionId,pDate){var lDetails$=apex.jQuery("#calendar_day_details_"+pRegionId,apex.gPageContext$);gOptions.curDate=pDate,apex.widget.cssCalendar.getDayData(pRegionId,pDate,{clear:function(){lDetails$.empty()},success:function(pData){lDetails$.html(pData)}})},widget.cssCalendar.getDayData=function(pRegionId,pDate){gOptions.curDate=pDate,server.plugin(gOptions.ajaxIdentifier,{x01:"GETDATA",x09:pDate,x10:pRegionId,pageItems:gOptions.pageItems},{dataType:"html",refreshObject:gRegion$,success:function(pData){apex.jQuery("#calendar_day_details_"+pRegionId,apex.gPageContext$).html(pData).trigger("create")},error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert(pErrorThrown)}})},widget.cssCalendar.getMobileCalendar=function(pTypeAction,pStart,pEnd,pCurrent){gOptions.startDate=pStart,gOptions.endDate=pEnd,gOptions.curDate=pCurrent,server.plugin(gOptions.ajaxIdentifier,{x01:pTypeAction,x02:gOptions.startDate,x03:gOptions.endDate,x09:gOptions.curDate,pageItems:gOptions.pageItems},{dataType:"html",refreshObject:gRegion$,success:function(pData){apex.jQuery(gRegion$,apex.gPageContext$).html(pData).trigger("create")},error:function(pjqXHR,pTextStatus,pErrorThrown){window.alert(pErrorThrown)}})},pWidth=function(pDivId){return apex.jQuery(pDivId).parent().width()},tDivs=function(pContainer,pDivId){return apex.jQuery(pContainer+' div[id="'+pDivId+'"]').length},lPos=function(pContainer,pDivId){return apex.jQuery(pContainer+' div[id="'+pDivId+'"]:first').parent().position().left},positionObjects=function(pContainer,pDivId,pInitPos,pWidth){var lPos=pInitPos;apex.jQuery(pContainer+'div[id="'+pDivId+'"]').each(function(){apex.jQuery(this).width(pWidth),apex.jQuery(this).css("left",lPos),lPos+=pWidth})},setHeight=function(){var headHeight,allDayHeight,bodyHeight,lHeight,lBody,lScroller=apex.jQuery('div[id="cal_scroll_div"]'),lViewHeight=Math.round(apex.jQuery('div[id="cal_main"]').width()/1.35);lBody=apex.jQuery('table[id="cal_main_table"]').find("tbody"),1==apex.jQuery(lBody).length&&(headHeight=apex.jQuery(lBody).position().top,allDayHeight=apex.jQuery(lScroller).position().top,bodyHeight=Math.min(lViewHeight-headHeight,apex.jQuery('div[id="cal_days"]').height()+allDayHeight+1),lHeight=500>bodyHeight-allDayHeight-1?500:bodyHeight-allDayHeight-1,lScroller.height(lHeight),apex.jQuery('div[id="cal_div_filler"]').height(lHeight+50))},setWidth=function(){var lScrollDiv,lSWidth,lIWidth,lDwidth=apex.jQuery("td.m-Calendar-Day.priority1:first").width(),lHourwidth=apex.jQuery("th.m-Calendar-HourTitle:first").width();lScrollDiv=apex.jQuery('div[id="cal_scroll_div"]'),1==apex.jQuery(lScrollDiv).length&&(lSWidth=apex.jQuery(lScrollDiv).get(0).clientWidth,lIWidth=apex.jQuery(lScrollDiv).width(),lIWidth-lSWidth?(apex.jQuery("td.m-Calendar-DivFiller").show(),apex.jQuery("th.m-Calendar-DivFiller").show()):(apex.jQuery("td.m-Calendar-DivFiller").hide(),apex.jQuery("th.m-Calendar-DivFiller").hide()),apex.jQuery("th.m-Calendar-DayOfWeek").each(function(){apex.jQuery(this).width(lDwidth)}),apex.jQuery("td.m-Calendar-AllDay").each(function(){apex.jQuery(this).width(lDwidth)}),apex.jQuery("th.m-Calendar-AlldayTitle").each(function(){apex.jQuery(this).width(lHourwidth+1)}),apex.jQuery("th.m-Calendar-HeadFiller").width(lHourwidth+Math.round(lHourwidth/3)),apex.jQuery("th.m-Calendar-DayOfWeek:first").css("left",apex.jQuery("td.m-Calendar-Day.priority1:first").position().left))},widget.cssCalendar.orientationchange=function(pCaltype,pEvent){"landscape"===pEvent.orientation?apex.jQuery(window).width()<=480&&"WEK"===pCaltype&&apex.widget.cssCalendar.getMobileCalendar("WKS_SAME",gOptions.startDate,gOptions.endDate,gOptions.curDate,""):apex.jQuery(window).width()<=480&&("WEK"==pCaltype||"WKS"==pCaltype)&&apex.widget.cssCalendar.getMobileCalendar("LST_SAME",gOptions.startDate,gOptions.endDate,gOptions.curDate,"")},widget.cssCalendar.arrangeObjects=function(pContainer,pCount){var lWidth,lParentwidth;setHeight(),setWidth();for(var i=1;pCount>=i;i++)lParentwidth=pWidth(pContainer+"div[id=day"+i+"]"),lWidth=Math.round((lParentwidth-Math.round(lParentwidth/20))/tDivs(pContainer,"day"+i)),positionObjects(pContainer,"day"+i,lPos(pContainer,"day"+i),lWidth)}}}(apex.widget,apex.util,apex.server,apex.jQuery);