!function(widget,$){widget.shuttle=function(pSelector,pOptions){function _triggerRefresh(){gShuttle.trigger("apexrefresh")}function _clear(){gSavedOptionsLeft=gShuttleListLeft.empty().children(),gSavedOptionsRight=gShuttleListRight.empty().children()}function _addResult(pData){var lHtml="";$.each(pData.values,function(){lHtml=lHtml+'<option value="'+this.r+'" '+gOptions.optionAttributes+">"+this.d+"</option>"}),gShuttleListLeft.html(lHtml),$s(gShuttle[0],pData["default"]),gSavedOptionsLeft=$("option",gShuttleListLeft),gSavedOptionsRight=$("option",gShuttleListRight)}function refresh(){widget.util.cascadingLov(gShuttle,gOptions.ajaxIdentifier,{pageItems:$(gOptions.pageItemsToSubmit,apex.gPageContext$)},{optimizeRefresh:gOptions.optimizeRefresh,dependingOn:$(gOptions.dependingOnSelector,apex.gPageContext$),loadingIndicator:gShuttle,success:_addResult,clear:_clear})}function _reset(pEvent){var prevValue=$v(gShuttle[0]);gShuttleListLeft.empty().append(gSavedOptionsLeft).children().prop("selected",!1),gShuttleListRight.empty().append(gSavedOptionsRight).children().prop("selected",!1),$v(gShuttle[0])!==prevValue&&gShuttle.change(),pEvent.preventDefault()}function _move(pEvent,pAll){var $OptionsToMove=$("option"+(pAll?"":":selected"),gShuttleListLeft);$("option:selected",gShuttleListRight).prop("selected",!1),$OptionsToMove.length&&($OptionsToMove.appendTo(gShuttleListRight).prop("selected",!0),gShuttle.change()),pEvent.preventDefault()}function _moveAll(pEvent){_move(pEvent,!0)}function _remove(pEvent,pAll,noNotify){var $OptionsToRemove=$("option"+(pAll?"":":selected"),gShuttleListRight);$("option:selected",gShuttleListLeft).prop("selected",!1),$OptionsToRemove.length&&($OptionsToRemove.appendTo(gShuttleListLeft).prop("selected",!0),noNotify||gShuttle.change()),pEvent&&pEvent.preventDefault()}function _removeAll(pEvent,noNotify){_remove(pEvent,!0,noNotify)}function _moveTop(pEvent){var prevValue=$v(gShuttle[0]);$("option:selected",gShuttleListRight).prependTo(gShuttleListRight).prop("selected",!0),$v(gShuttle[0])!==prevValue&&gShuttle.trigger("shuttlechangeorder"),pEvent.preventDefault()}function _moveUp(pEvent){var moved=!1;$("option:selected",gShuttleListRight).each(function(){var lPrevOption=$(this).prev();0===lPrevOption.length||lPrevOption.prop("selected")||($(this).insertBefore(lPrevOption).prop("selected",!0),moved=!0)}),moved&&gShuttle.trigger("shuttlechangeorder"),pEvent.preventDefault()}function _moveDown(pEvent){var i,lNextOption$,moved=!1,selectedOptions$=$("option:selected",gShuttleListRight);for(i=selectedOptions$.length-1;i>=0;i--)lNextOption$=selectedOptions$.eq(i).next(),0===lNextOption$.length||lNextOption$.prop("selected")||(selectedOptions$.eq(i).insertAfter(lNextOption$).prop("selected",!0),moved=!0);moved&&gShuttle.trigger("shuttlechangeorder"),pEvent.preventDefault()}function _moveBottom(pEvent){var prevValue=$v(gShuttle[0]);$("option:selected",gShuttleListRight).appendTo(gShuttleListRight).prop("selected",!0),$v(gShuttle[0])!==prevValue&&gShuttle.trigger("shuttlechangeorder"),pEvent.preventDefault()}function _stopEvent(pEvent){pEvent.stopImmediatePropagation()}function _bindIconClickHandlers(){$(pSelector+"_RESET",apex.gPageContext$).click(_reset),$(pSelector+"_MOVE",apex.gPageContext$).click(_move),$(pSelector+"_MOVE_ALL",apex.gPageContext$).click(_moveAll),$(pSelector+"_REMOVE",apex.gPageContext$).click(_remove),$(pSelector+"_REMOVE_ALL",apex.gPageContext$).click(_removeAll),$(pSelector+"_TOP",apex.gPageContext$).click(_moveTop),$(pSelector+"_UP",apex.gPageContext$).click(_moveUp),$(pSelector+"_DOWN",apex.gPageContext$).click(_moveDown),$(pSelector+"_BOTTOM",apex.gPageContext$).click(_moveBottom)}var gOptions=$.extend({optionAttributes:null},pOptions),gShuttle=$(pSelector,apex.gPageContext$),gShuttleListLeft=$(pSelector+"_LEFT",apex.gPageContext$),gShuttleListRight=$(pSelector+"_RIGHT",apex.gPageContext$),gSavedOptionsLeft=$("option",gShuttleListLeft),gSavedOptionsRight=$("option",gShuttleListRight);$(pSelector,apex.gPageContext$).each(function(){var self=this;widget.initPageItem(this.id,{enable:function(){var lFieldset;lFieldset=$x(self.id),$("button",lFieldset).prop("disabled",!1).removeClass("is-disabled"),$("select",lFieldset).prop("disabled",!1).removeClass("apex_disabled")},disable:function(){var lFieldset;lFieldset=$x(self.id),$("option:selected",lFieldset).prop("selected",!1),$("button",lFieldset).prop("disabled",!0).addClass("is-disabled"),$("select",lFieldset).prop("disabled",!0).addClass("apex_disabled")},setValue:function(pValue){var lValueArray;_removeAll(null,!0),lValueArray=apex.util.toArray(pValue);for(var i=0;i<lValueArray.length;i++)$("option",gShuttleListLeft[0]).each(function(){return this.value===lValueArray[i]?($(this).appendTo(gShuttleListRight).prop("selected",!0),!1):void 0})},getValue:function(){var lReturn=[];return $("option",gShuttleListRight[0]).each(function(){lReturn.push(this.value)}),lReturn},setFocusTo:gShuttleListLeft,loadingIndicator:function(pLoadingIndicator$){return pLoadingIndicator$.prependTo($("td.shuttleControl",gShuttle))}})}),window.flowSelectArray||(window.flowSelectArray=[]),window.flowSelectArray.push(gShuttleListRight.attr("id")),gOptions.dependingOnSelector&&$(gOptions.dependingOnSelector,apex.gPageContext$).change(_triggerRefresh),gShuttle.bind("apexrefresh",refresh),gShuttleListLeft.change(_stopEvent),gShuttleListRight.change(_stopEvent),$(gShuttleListLeft).dblclick(_move).keydown(function(e){13===e.which&&(_move(e,!1),e.preventDefault())}),$(gShuttleListRight).dblclick(_remove).keydown(function(e){13===e.which&&(_remove(e),e.preventDefault())}),_bindIconClickHandlers()}}(apex.widget,apex.jQuery);