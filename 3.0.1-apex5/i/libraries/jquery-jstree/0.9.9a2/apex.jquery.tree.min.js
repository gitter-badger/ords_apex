/*
 * jsTree 0.9.9a (Oracle modified version with some bug fixing)
 * http://jstree.com/
 *
 * Copyright (c) 2009 Ivan Bozhanov (vakata.com)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Date: 2009-10-06
 *
 */
!function(a){function b(){return{cntr:++b.cntr,settings:a.extend({},a.tree.defaults),init:function(c,d){var e=this;if(this.container=a(c),0==this.container.size)return!1;if(b.inst[this.cntr]=this,this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr),b.inst[this.container.attr("id")]=b.inst[this.cntr],b.focused=this.cntr,this.settings=a.extend(!0,{},this.settings,d),this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];for(var f=!1,g="#"+this.container.attr("id"),h=0;h<this.settings.languages.length;h++)f=b.add_css(g+" ."+this.settings.languages[h]),f!==!1&&(f.style.display=this.settings.languages[h]==this.current_lang?"":"none")}else this.current_lang=!1;this.container.addClass("tree clearfix"),this.settings.ui.theme_name!==!1&&(this.settings.ui.theme_path===!1&&a("script").each(function(){return this.src.toString().match(/apex\.jquery\.tree.*?js$/)?(e.settings.ui.theme_path=this.src.toString().replace(/apex\.jquery\.tree.*?js$/,"")+"themes/"+e.settings.ui.theme_name+"/style.css",!1):void 0}),""!=this.settings.ui.theme_path&&-1==a.inArray(this.settings.ui.theme_path,b.themes)&&(b.add_sheet({url:this.settings.ui.theme_path}),b.themes.push(this.settings.ui.theme_path)),this.container.addClass("tree-"+this.settings.ui.theme_name));var i="";for(var j in this.settings.types)this.settings.types.hasOwnProperty(j)&&this.settings.types[j].icon&&(this.settings.types[j].icon.image||this.settings.types[j].icon.position)&&(i+="default"==j?"#"+this.container.attr("id")+" li > a ins { ":"#"+this.container.attr("id")+" li[rel="+j+"] > a ins { ",this.settings.types[j].icon.image&&(i+=" background-image:url("+this.settings.types[j].icon.image+"); "),this.settings.types[j].icon.position&&(i+=" background-position:"+this.settings.types[j].icon.position+"; "),i+="} ");""!=i&&b.add_sheet({str:i}),this.settings.rules.multiple&&(this.selected_arr=[]),this.offset=!1,this.hovered=!1,this.locked=!1,b.drag_drop.marker===!1&&(b.drag_drop.marker=a("<div>").attr({id:"jstree-marker"}).hide().appendTo("body")),this.callback("oninit",[this]),this.refresh(),this.attach_events(),this.focus()},refresh:function(b){if(this.locked)return this.error("LOCKED");var c=this;if(b&&!this.settings.data.async&&(b=!1),this.is_partial_refresh=b?!0:!1,this.opened=Array(),0!=this.settings.opened?(a.each(this.settings.opened,function(){this.replace(/^#/,"").length>0&&c.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(){this.id&&c.opened.push("#"+this.id)}),this.selected)this.settings.selected=Array(),b?a(b).find("li:has(a.clicked)").each(function(){this.id&&c.settings.selected.push("#"+this.id)}):this.selected_arr?a.each(this.selected_arr,function(){this.attr("id")&&c.settings.selected.push("#"+this.attr("id"))}):this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"));else if(this.settings.selected!==!1){var d=Array();"object"==(typeof this.settings.selected).toLowerCase()?a.each(this.settings.selected,function(){this.replace(/^#/,"").length>0&&d.push("#"+this.replace(/^#/,""))}):this.settings.selected.replace(/^#/,"").length>0&&d.push("#"+this.settings.selected.replace(/^#/,"")),this.settings.selected=d}if(b&&this.settings.data.async)return this.opened=Array(),b=this.get_node(b),b.find("li.open").each(function(){c.opened.push("#"+this.id)}),b.hasClass("open")&&b.removeClass("open").addClass("closed"),b.hasClass("leaf")&&b.removeClass("leaf"),b.children("ul:eq(0)").html(""),this.open_branch(b,!0,function(){c.reselect.apply(c)});var c=this,e=new a.tree.datastores[this.settings.data.type];0==this.container.children("ul").size()&&this.container.html("<ul class='ltr' style='direction:ltr;'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||"Loading ...")+"</a></li></ul>"),e.load(this.callback("beforedata",[!1,this]),this,this.settings.data.opts,function(b){b=c.callback("ondata",[b,c]),e.parse(b,c,c.settings.data.opts,function(b){b=c.callback("onparse",[b,c]),c.container.empty().append(a("<ul class='ltr'>").html(b)),c.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),c.container.find("li").not(".open").not(".closed").addClass("leaf"),c.reselect()})})},reselect:function(b){var c=this;if(b?this.cl_count--:this.cl_count=0,this.opened&&this.opened.length){for(var d=!1,e=0;this.opened&&e<this.opened.length;e++)if(this.settings.data.async){var f=this.get_node(this.opened[e]);if(f.size()&&f.hasClass("closed")>0){d=!0;var f=this.opened[e].toString().replace("/","\\/");delete this.opened[e],this.open_branch(f,!0,function(){c.reselect.apply(c,[!0])}),this.cl_count++}}else this.open_branch(this.opened[e],!0);if(this.settings.data.async&&d)return;if(this.cl_count>0)return;delete this.opened}this.cl_count>0||(this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr"),0==this.settings.ui.dots&&this.container.children("ul:eq(0)").addClass("no_dots"),this.scrtop&&(this.container.scrollTop(c.scrtop),delete this.scrtop),this.settings.selected!==!1&&(a.each(this.settings.selected,function(b){c.is_partial_refresh?c.select_branch(a(c.settings.selected[b].toString().replace("/","\\/"),c.container),c.settings.rules.multiple!==!1):c.select_branch(a(c.settings.selected[b].toString().replace("/","\\/"),c.container),c.settings.rules.multiple!==!1&&b>0)}),this.settings.selected=!1),this.callback("onload",[c]))},get:function(b,c,d){return c||(c=this.settings.data.type),d||(d=this.settings.data.opts),(new a.tree.datastores[c]).get(b,this,d)},attach_events:function(){var c=this;this.container.bind("mousedown.jstree",function(a){return b.drag_drop.isdown?(b.drag_drop.move_type=!1,a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1):void 0}).bind("mouseup.jstree",function(){setTimeout(function(){c.focus.apply(c)},5)}).bind("click.jstree",function(){return!0}),a("li",this.container.get(0)).live("click",function(b){return"LI"!=b.target.tagName?!0:(c.off_height(),b.pageY-a(b.target).offset().top>c.li_height?!0:(c.toggle_branch.apply(c,[b.target]),b.stopPropagation(),!1))}),a("a",this.container.get(0)).live("click",function(a){return a.which&&3==a.which?!0:c.locked?(a.preventDefault(),a.target.blur(),c.error("LOCKED")):(c.select_branch.apply(c,[a.target,a.ctrlKey||a.metaKey||"on"==c.settings.rules.multiple]),c.inp&&c.inp.blur(),a.preventDefault(),a.target.blur(),!1)}).live("dblclick",function(a){return c.locked?(a.preventDefault(),a.stopPropagation(),a.target.blur(),c.error("LOCKED")):(c.callback("ondblclk",[c.get_node(a.target).get(0),c]),a.preventDefault(),a.stopPropagation(),a.target.blur(),void 0)}).live("contextmenu",function(a){return c.locked?(a.target.blur(),c.error("LOCKED")):c.callback("onrgtclk",[c.get_node(a.target).get(0),c,a])}).live("mouseover",function(a){return c.locked?(a.preventDefault(),a.stopPropagation(),c.error("LOCKED")):(c.hovered===!1||"A"!=a.target.tagName&&"INS"!=a.target.tagName||(c.hovered.children("a").removeClass("hover"),c.hovered=!1),c.callback("onhover",[c.get_node(a.target).get(0),c]),void 0)}).live("mousedown",function(d){if("left"==c.settings.rules.drag_button&&d.which&&1!=d.which)return!0;if("right"==c.settings.rules.drag_button&&d.which&&3!=d.which)return!0;if(c.focus.apply(c),c.locked)return c.error("LOCKED");var e=c.get_node(d.target);if(0!=c.settings.rules.multiple&&c.selected_arr.length>1&&e.children("a:eq(0)").hasClass("clicked")){var f=0;for(var g in c.selected_arr)c.selected_arr.hasOwnProperty(g)&&c.check("draggable",c.selected_arr[g])&&(c.selected_arr[g].addClass("dragged"),b.drag_drop.origin_tree=c,f++);if(f>0){b.drag_drop.drag_node=c.check("draggable",e)?e:c.container.find("li.dragged:eq(0)"),b.drag_drop.isdown=!0,b.drag_drop.drag_help=a("<div id='jstree-dragged' class='tree "+(""!=c.settings.ui.theme_name?" tree-"+c.settings.ui.theme_name:"")+"' />").append("<ul class='"+c.container.children("ul:eq(0)").get(0).className+"' />");var h=b.drag_drop.drag_node.clone();c.settings.languages.length>0&&h.find("a").not("."+c.current_lang).hide(),b.drag_drop.drag_help.children("ul:eq(0)").append(h),b.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove(),b.drag_drop.dragged=c.container.find("li.dragged")}}else if(c.check("draggable",e)){b.drag_drop.drag_node=e,b.drag_drop.drag_help=a("<div id='jstree-dragged' class='tree "+(""!=c.settings.ui.theme_name?" tree-"+c.settings.ui.theme_name:"")+"' />").append("<ul class='"+c.container.children("ul:eq(0)").get(0).className+"' />");var h=e.clone();c.settings.languages.length>0&&h.find("a").not("."+c.current_lang).hide(),b.drag_drop.drag_help.children("ul:eq(0)").append(h),b.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last"),b.drag_drop.isdown=!0,b.drag_drop.foreign=!1,b.drag_drop.origin_tree=c,e.addClass("dragged"),b.drag_drop.dragged=c.container.find("li.dragged")}return b.drag_drop.init_x=d.pageX,b.drag_drop.init_y=d.pageY,e.blur(),d.preventDefault(),d.stopPropagation(),!1})},focus:function(){return this.locked?!1:(b.focused!=this.cntr&&(b.focused=this.cntr,this.callback("onfocus",[this])),void 0)},off_height:function(){if(this.offset===!1){this.container.css({position:"relative"}),this.offset=this.container.offset();var b=0;b=parseInt(a.curCSS(this.container.get(0),"paddingTop",!0),10),b&&(this.offset.top+=b),b=parseInt(a.curCSS(this.container.get(0),"borderTopWidth",!0),10),b&&(this.offset.top+=b),this.container.css({position:""})}if(!this.li_height){var b=this.container.find("ul li.closed, ul li.leaf").eq(0);this.li_height=b.height(),b.children("ul:eq(0)").size()&&(this.li_height-=b.children("ul:eq(0)").height()),this.li_height||(this.li_height=18)}},scroll_check:function(a,c){var d=this,e=d.container,f=d.container.offset(),g=e.scrollTop(),h=e.scrollLeft(),i=e.get(0).scrollWidth>e.width()?40:20;c-f.top<20&&e.scrollTop(Math.max(g-d.settings.ui.scroll_spd,0)),e.height()-(c-f.top)<i&&e.scrollTop(g+d.settings.ui.scroll_spd),a-f.left<20&&e.scrollLeft(Math.max(h-d.settings.ui.scroll_spd,0)),e.width()-(a-f.left)<40&&e.scrollLeft(h+d.settings.ui.scroll_spd),(e.scrollLeft()!=h||e.scrollTop()!=g)&&(b.drag_drop.move_type=!1,b.drag_drop.ref_node=!1,b.drag_drop.marker.hide()),b.drag_drop.scroll_time=setTimeout(function(){d.scroll_check(a,c)},50)},scroll_into_view:function(a){if(a=a?this.get_node(a):this.selected,!a)return!1;var b=a.offset().top,c=this.container.offset().top,d=c+this.container.height(),e=this.container.get(0).scrollWidth>this.container.width()?40:20;c>b+5&&this.container.scrollTop(this.container.scrollTop()-(c-b+5)),b+e>d&&this.container.scrollTop(this.container.scrollTop()+(b+e-d))},get_node:function(b){return a(b).closest("li")},get_type:function(a){if(a=a?this.get_node(a):this.selected){var b=a.attr(this.settings.rules.type_attr);return b||"default"}},set_type:function(a,b){b=b?this.get_node(b):this.selected,b&&a&&b.attr(this.settings.rules.type_attr,a)},get_text:function(a,b){if(a=this.get_node(a),!a||0==a.size())return"";this.settings.languages&&this.settings.languages.length?(b=b?b:this.current_lang,a=a.children("a."+b)):a=a.children("a:visible");var c="";return a.contents().each(function(){return 3==this.nodeType?(c=this.data,!1):void 0}),c},check:function(a,b){if(this.locked)return!1;var c=!1;if(-1===b)"undefined"!=typeof this.settings.rules[a]&&(c=this.settings.rules[a]);else{if(b=b?this.get_node(b):this.selected,!b)return;var d=this.get_type(b);"undefined"!=typeof this.settings.types[d]&&"undefined"!=typeof this.settings.types[d][a]?c=this.settings.types[d][a]:"undefined"!=typeof this.settings.types["default"]&&"undefined"!=typeof this.settings.types["default"][a]&&(c=this.settings.types["default"][a])}return"function"==typeof c&&(c=c.call(null,b,this)),c=this.callback("check",[a,b,c,this])},check_move:function(c,d,e){if(this.locked)return!1;if(a(d).closest("li.dragged").size())return!1;var f=c.parents(".tree:eq(0)").get(0),g=d.parents(".tree:eq(0)").get(0);if(f&&f!=g){var h=a.tree.reference(g.id).settings.rules.multitree;if("none"==h||a.isArray(h)&&-1==a.inArray(f.id,h))return!1}var i="inside"!=e?this.parent(d):this.get_node(d);if(c=this.get_node(c),0==i)return!1;var j={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",i):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",i):-1,valid_children:this.check("valid_children",i)},k="string"==typeof c?c:this.get_type(c);if("undefined"!=typeof j.valid_children&&("none"==j.valid_children||"object"==typeof j.valid_children&&-1==a.inArray(k,a.makeArray(j.valid_children))))return!1;if(this.settings.rules.use_max_children&&"undefined"!=typeof j.max_children&&-1!=j.max_children){if(0==j.max_children)return!1;var l=1;if(1==b.drag_drop.moving&&0==b.drag_drop.foreign&&(l=b.drag_drop.dragged.size(),l-=i.find("> ul > li.dragged").size()),j.max_children<i.find("> ul > li").size()+l)return!1}if(this.settings.rules.use_max_depth){if("undefined"!=typeof j.max_depth&&0===j.max_depth)return this.error("MOVE: MAX-DEPTH REACHED");for(var m=j.max_depth>0?j.max_depth:!1,n=0,o=i;-1!==o;){o=this.parent(o),n++;var h=this.check("max_depth",o);if(h>=0&&(m=m===!1?h-n:Math.min(m,h-n)),m!==!1&&0>=m)return this.error("MOVE: MAX-DEPTH REACHED")}if(m!==!1&&0>=m)return this.error("MOVE: MAX-DEPTH REACHED");if(m!==!1){var p=1;if("string"!=typeof c)for(var o=c;o.size()>0;){if(0>m-p)return this.error("MOVE: MAX-DEPTH REACHED");o=o.children("ul").children("li"),p++}}}return 0==this.callback("check_move",[c,d,e,this])?!1:!0},hover_branch:function(a){if(this.locked)return this.error("LOCKED");var b=this,a=b.get_node(a);return a.size()?b.check("clickable",a)?(this.hovered&&this.hovered.children("A").removeClass("hover"),this.hovered=a,this.hovered.children("a").addClass("hover"),this.scroll_into_view(this.hovered),void 0):this.error("SELECT: NODE NOT SELECTABLE"):this.error("HOVER: NOT A VALID NODE")},select_branch:function(a,b){if(this.locked)return this.error("LOCKED");a||this.hovered===!1||(a=this.hovered);var c=this;if(a=c.get_node(a),!a.size())return this.error("SELECT: NOT A VALID NODE");if(a.children("a").removeClass("hover"),!c.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");if(c.callback("beforechange",[a.get(0),c])===!1)return this.error("SELECT: STOPPED BY USER");if(0!=this.settings.rules.multiple&&b&&a.children("a.clicked").size()>0)return this.deselect_branch(a);if(0!=this.settings.rules.multiple&&b&&this.selected_arr.push(a),0!=this.settings.rules.multiple&&!b){for(var d in this.selected_arr)this.selected_arr.hasOwnProperty(d)&&(this.selected_arr[d].children("A").removeClass("clicked"),this.callback("ondeselect",[this.selected_arr[d].get(0),c]));this.selected_arr=[],this.selected_arr.push(a),this.selected&&this.selected.children("A").hasClass("clicked")&&(this.selected.children("A").removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),c]))}this.settings.rules.multiple||this.selected&&(this.selected.children("A").removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),c])),this.selected=a,this.hovered!==!1&&(this.hovered.children("A").removeClass("hover"),this.hovered=a),this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){c.open_branch(this,!0)}),this.scroll_into_view(this.selected),this.callback("onselect",[this.selected.get(0),c]),this.callback("onchange",[this.selected.get(0),c])},deselect_branch:function(b){if(this.locked)return this.error("LOCKED");var c=this,b=this.get_node(b);return 0==b.children("a.clicked").size()?this.error("DESELECT: NODE NOT SELECTED"):(b.children("a").removeClass("clicked"),this.callback("ondeselect",[b.get(0),c]),0!=this.settings.rules.multiple&&this.selected_arr.length>1?(this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){c.selected_arr.push(a(this))}),b.get(0)==this.selected.get(0)&&(this.selected=this.selected_arr[0])):(0!=this.settings.rules.multiple&&(this.selected_arr=[]),this.selected=!1),this.callback("onchange",[b.get(0),c]),void 0)},toggle_branch:function(a){if(this.locked)return this.error("LOCKED");var a=this.get_node(a);return a.hasClass("closed")?this.open_branch(a):a.hasClass("open")?this.close_branch(a):void 0},open_branch:function(b,c,d){var e=this;if(this.locked)return this.error("LOCKED");var b=this.get_node(b);if(!b.size())return this.error("OPEN: NO SUCH NODE");if(b.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&0==b.find("li").size()){if(this.callback("beforeopen",[b.get(0),this])===!1)return this.error("OPEN: STOPPED BY USER");b.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(e.settings.lang.loading||"Loading ...")+"</a></li></ul>"),b.removeClass("closed").addClass("open");var f=new a.tree.datastores[this.settings.data.type];return f.load(this.callback("beforedata",[b,this]),this,this.settings.data.opts,function(c){return c=e.callback("ondata",[c,e]),c&&0!=c.length?(f.parse(c,e,e.settings.data.opts,function(c){c=e.callback("onparse",[c,e]),b.children("ul:eq(0)").replaceWith(a("<ul>").html(c)),b.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),b.find("li").not(".open").not(".closed").addClass("leaf"),e.open_branch.apply(e,[b]),d&&d.call()}),void 0):(b.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),d&&d.call(),void 0)}),!0}return this.settings.data.async||this.callback("beforeopen",[b.get(0),this])!==!1?(parseInt(this.settings.ui.animation)>0&&!c?(b.children("ul:eq(0)").css("display","none"),b.removeClass("closed").addClass("open"),b.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){a(this).css("display",""),d&&d.call()})):(b.removeClass("closed").addClass("open"),d&&d.call()),this.callback("onopen",[b.get(0),this]),!0):this.error("OPEN: STOPPED BY USER")},close_branch:function(b,c){if(this.locked)return this.error("LOCKED");var d=this,b=this.get_node(b);return b.size()?d.callback("beforeclose",[b.get(0),d])===!1?this.error("CLOSE: STOPPED BY USER"):(parseInt(this.settings.ui.animation)>0&&!c&&1==b.children("ul:eq(0)").size()?b.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){b.hasClass("open")&&b.removeClass("open").addClass("closed"),a(this).css("display","")}):b.hasClass("open")&&b.removeClass("open").addClass("closed"),this.selected&&this.settings.ui.selected_parent_close!==!1&&b.children("ul:eq(0)").find("a.clicked").size()>0&&(b.find("li:has(a.clicked)").each(function(){d.deselect_branch(this)}),"select_parent"==this.settings.ui.selected_parent_close&&0==b.children("a.clicked").size()&&this.select_branch(b,0!=this.settings.rules.multiple&&this.selected_arr.length>0)),this.callback("onclose",[b.get(0),this]),void 0):this.error("CLOSE: NO SUCH NODE")},open_all:function(a,b){if(this.locked)return this.error("LOCKED");var c=this;a=a?this.get_node(a):this.container;var d=a.find("li.closed").size();b?this.cl_count--:this.cl_count=0,d>0?(this.cl_count+=d,a.find("li.closed").each(function(){var a=this;c.open_branch.apply(c,[this,!0,function(){c.open_all.apply(c,[a,!0])}])})):0==this.cl_count&&this.callback("onopen_all",[this])},close_all:function(a){if(this.locked)return this.error("LOCKED");var b=this;a=a?this.get_node(a):this.container,a.find("li.open").each(function(){b.close_branch(this,!0)}),this.callback("onclose_all",[this])},set_lang:function(c){if(!a.isArray(this.settings.languages)||0==this.settings.languages.length)return!1;if(this.locked)return this.error("LOCKED");if(a.inArray(c,this.settings.languages)||"undefined"==typeof this.settings.languages[c]||(c=this.settings.languages[c]),"undefined"==typeof c)return!1;if(c==this.current_lang)return!0;var d=!1,e="#"+this.container.attr("id");return d=b.get_css(e+" ."+this.current_lang),d!==!1&&(d.style.display="none"),d=b.get_css(e+" ."+c),d!==!1&&(d.style.display=""),this.current_lang=c,!0},get_lang:function(){return a.isArray(this.settings.languages)&&0!=this.settings.languages.length?this.current_lang:!1},create:function(b,c,d){if(this.locked)return this.error("LOCKED");var e=!1;if(-1==c?(e=!0,c=this.container):c=c?this.get_node(c):this.selected,!(e||c&&c.size()))return this.error("CREATE: NO NODE SELECTED");var f=d,g=c;if("before"==d&&(d=c.parent().children().index(c),c=c.parents("li:eq(0)")),"after"==d&&(d=c.parent().children().index(c)+1,c=c.parents("li:eq(0)")),e||0!=c.size()||(e=!0,c=this.container),!e){if(!this.check("creatable",c))return this.error("CREATE: CANNOT CREATE IN NODE");if(c.hasClass("closed")){if(this.settings.data.async&&0==c.children("ul").size()){var h=this;return this.open_branch(c,!0,function(){h.create.apply(h,[b,c,d])})}this.open_branch(c,!0)}}var i=!1;if(b=b?a.extend(!0,{},b):{},b.attributes||(b.attributes={}),b.attributes[this.settings.rules.type_attr]||(b.attributes[this.settings.rules.type_attr]=this.get_type(g)||"default"),this.settings.languages.length){b.data||(b.data={},i=!0);for(var j=0;j<this.settings.languages.length;j++)b.data[this.settings.languages[j]]||(b.data[this.settings.languages[j]]="string"!=(typeof this.settings.lang.new_node).toLowerCase()&&this.settings.lang.new_node[j]?this.settings.lang.new_node[j]:this.settings.lang.new_node)}else b.data||(b.data=this.settings.lang.new_node,i=!0);b=this.callback("ondata",[b,this]);var k=a.tree.datastores.json().parse(b,this);k=this.callback("onparse",[k,this]);var l=a(k);l.children("ul").size()?l.is(".open")||l.addClass("closed"):l.addClass("leaf"),l.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),l.find("li").not(".open").not(".closed").addClass("leaf");var m={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",e?-1:c):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",e?-1:c):-1,valid_children:this.check("valid_children",e?-1:c)},n=this.get_type(l);if("undefined"!=typeof m.valid_children&&("none"==m.valid_children||a.isArray(m.valid_children)&&-1==a.inArray(n,m.valid_children)))return this.error("CREATE: NODE NOT A VALID CHILD");if(this.settings.rules.use_max_children&&"undefined"!=typeof m.max_children&&-1!=m.max_children&&m.max_children>=this.children(c).size())return this.error("CREATE: MAX_CHILDREN REACHED");if(this.settings.rules.use_max_depth){if("undefined"!=typeof m.max_depth&&0===m.max_depth)return this.error("CREATE: MAX-DEPTH REACHED");for(var o=m.max_depth>0?m.max_depth:!1,j=0,p=c;-1!==p&&!e;){p=this.parent(p),j++;var q=this.check("max_depth",p);if(q>=0&&(o=o===!1?q-j:Math.min(o,q-j)),o!==!1&&0>=o)return this.error("CREATE: MAX-DEPTH REACHED")}if(o!==!1&&0>=o)return this.error("CREATE: MAX-DEPTH REACHED");if(o!==!1)for(var r=1,p=l;p.size()>0;){if(0>o-r)return this.error("CREATE: MAX-DEPTH REACHED");p=p.children("ul").children("li"),r++}}if(("undefined"==(typeof d).toLowerCase()||"inside"==d)&&(d="top"==this.settings.rules.createat?0:c.children("ul:eq(0)").children("li").size()),0==c.children("ul").size()||1==e&&0==c.children("ul").children("li").size())if(e)var s=this.moved(l,this.container.children("ul:eq(0)"),"inside",!0);else var s=this.moved(l,c.children("a:eq(0)"),"inside",!0);else if("before"==f&&c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").size())var s=this.moved(l,c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").children("a:eq(0)"),"before",!0);else if("after"==f&&c.children("ul:eq(0)").children("li:nth-child("+d+")").size())var s=this.moved(l,c.children("ul:eq(0)").children("li:nth-child("+d+")").children("a:eq(0)"),"after",!0);else if(c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").size())var s=this.moved(l,c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").children("a:eq(0)"),"before",!0);else var s=this.moved(l,c.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!0);return s===!1?this.error("CREATE: ABORTED"):(i&&(this.select_branch(l.children("a:eq(0)")),this.rename()),l)},rename:function(b,c){if(this.locked)return this.error("LOCKED");b=b?this.get_node(b):this.selected;var d=this;if(!b||!b.size())return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",b))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.callback("beforerename",[b.get(0),d.current_lang,d]))return this.error("RENAME: STOPPED BY USER");b.parents("li.closed").each(function(){d.open_branch(this)}),b=this.current_lang?b.find("a."+this.current_lang):b.find("a:first");var e={};e[this.container.attr("id")]=this.get_rollback();var f=b.children("ins").clone();if("string"==(typeof c).toLowerCase())b.text(c).prepend(f),d.callback("onrename",[d.get_node(b).get(0),d,e]);else{var g="";b.contents().each(function(){return 3==this.nodeType?(g=this.data,!1):void 0}),d.inp=a("<input type='text' autocomplete='off' />"),d.inp.val(g.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(a){a.stopPropagation()}).bind("mouseup",function(a){a.stopPropagation()}).bind("click",function(a){a.stopPropagation()}).bind("keydown",function(a){var b=a.keyCode||a.which;return 27==b?(this.value=g,this.blur(),!1):13==b?(this.blur(),!1):void 0}),d.inp.blur(function(){""==this.value&&(this.value=g),b.text(this.value).prepend(f),b.get(0).style.display="",b.prevAll("span").remove(),d.inp=!1,d.callback("onrename",[d.get_node(b).get(0),d,e])});var h=a("<span />").addClass(b.attr("class")).append(f).append(d.inp);b.get(0).style.display="none",b.parent().prepend(h),d.inp.get(0).focus(),d.inp.get(0).select()}},remove:function(b){if(this.locked)return this.error("LOCKED");var c=this,d={};if(d[this.container.attr("id")]=this.get_rollback(),!b||this.selected&&this.get_node(b).get(0)==this.selected.get(0)){if(!this.selected)return this.error("DELETE: NO NODE SELECTED");if(!this.check("deletable",this.selected))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[this.selected.get(0),c]))return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();var b=this.selected;if(0==this.settings.rules.multiple||1==this.selected_arr.length)var f=!0,g="select_previous"==this.settings.ui.selected_delete?this.prev(this.selected):!1;if(b=b.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()),!f&&0!=this.settings.rules.multiple){var c=this;this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){c.selected_arr.push(a(this))}),this.selected_arr.length>0&&(this.selected=this.selected_arr[0],this.remove())}f&&g&&this.select_branch(g),this.callback("ondelete",[b.get(0),this,d])}else if(b=this.get_node(b),b.size()){if(!this.check("deletable",b))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[b.get(0),c]))return this.error("DELETE: STOPPED BY USER");if($parent=b.parent(),b.find("a.clicked").size()){var e=!1;c.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){return e||this!=c.selected.get(0)||(e=!0),-1!=a(this).parents().index(b)?!0:(c.selected_arr.push(a(this)),void 0)}),e&&(this.selected=this.selected_arr[0]||!1)}b=b.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()),this.callback("ondelete",[b.get(0),this,d])}},next:function(a,b){return a=this.get_node(a),a.size()?b?a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):!1:a.hasClass("open")?a.find("li:eq(0)"):a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):a.parents("li").next("li").eq(0):!1},prev:function(a,b){if(a=this.get_node(a),!a.size())return!1;if(b)return a.prevAll("li").size()>0?a.prevAll("li:eq(0)"):!1;if(a.prev("li").size()){for(var a=a.prev("li").eq(0);a.hasClass("open");)a=a.children("ul:eq(0)").children("li:last");return a}return a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):!1},parent:function(a){return a=this.get_node(a),a.size()?a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):-1:!1},children:function(a){return-1===a?this.container.children("ul:eq(0)").children("li"):(a=this.get_node(a),a.size()?a.children("ul:eq(0)").children("li"):!1)},toggle_dots:function(){this.settings.ui.dots?(this.settings.ui.dots=!1,this.container.children("ul:eq(0)").addClass("no_dots")):(this.settings.ui.dots=!0,this.container.children("ul:eq(0)").removeClass("no_dots"))},callback:function(b,c){var d=!1,e=null;for(var f in this.settings.plugins)if("object"==typeof a.tree.plugins[f]&&(d=a.tree.plugins[f],d.callbacks&&"function"==typeof d.callbacks[b]&&(e=d.callbacks[b].apply(this,c)),"undefined"!=typeof e&&null!==e)){if("ondata"!=b&&"onparse"!=b)return e;c[0]=e}return d=this.settings.callback[b],"function"==typeof d?d.apply(null,c):void 0},get_rollback:function(){var a={};return a.html=this.container.html(),a.selected=this.selected?this.selected.attr("id"):!1,a},moved:function(c,d,e,f,g,h){var c=a(c),i=a(c).parents("ul:eq(0)"),j=a(d);if(j.is("ins")&&(j=j.parent()),!h){var h={};if(h[this.container.attr("id")]=this.get_rollback(),!f){var k=c.size()>1?c.eq(0).parents(".tree:eq(0)"):c.parents(".tree:eq(0)");k.get(0)!=this.container.get(0)&&(k=b.inst[k.attr("id")],h[k.container.attr("id")]=k.get_rollback()),delete k}}if("inside"==e&&this.settings.data.async){var l=this;if(this.get_node(j).hasClass("closed"))return this.open_branch(this.get_node(j),!0,function(){l.moved.apply(l,[c,d,e,f,g,h])});if(1==this.get_node(j).find("> ul > li > a.loading").size())return setTimeout(function(){l.moved.apply(l,[c,d,e,f,g])},200),void 0}if(c.size()>1){var l=this,k=this.moved(c.eq(0),d,e,!1,g,h);return c.each(function(a){0!=a&&k&&(k=l.moved(this,k.children("a:eq(0)"),"after",!1,g,h))}),c}if(g?(_what=c.clone(),_what.each(function(){this.id=this.id+"_copy",a(this).find("li").each(function(){this.id=this.id+"_copy"}),a(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged")})):_what=c,f){if(!this.callback("beforecreate",[this.get_node(c).get(0),this.get_node(d).get(0),e,this]))return!1}else if(!this.callback("beforemove",[this.get_node(c).get(0),this.get_node(d).get(0),e,this]))return!1;if(!f){var k=c.parents(".tree:eq(0)");if(k.get(0)!=this.container.get(0)){if(k=b.inst[k.attr("id")],k.settings.languages.length){var m=[];if(0==this.settings.languages.length)m.push("."+k.current_lang);else for(var n in this.settings.languages)if(this.settings.languages.hasOwnProperty(n))for(var o in k.settings.languages)k.settings.languages.hasOwnProperty(o)&&this.settings.languages[n]==k.settings.languages[o]&&m.push("."+this.settings.languages[n]);if(0==m.length)return this.error("MOVE: NO COMMON LANGUAGES");_what.find("a").not(m.join(",")).remove()}_what.find("a.clicked").removeClass("clicked")}}switch(c=_what,e){case"before":j.parents("ul:eq(0)").children("li.last").removeClass("last"),j.parent().before(c.removeClass("last")),j.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":j.parents("ul:eq(0)").children("li.last").removeClass("last"),j.parent().after(c.removeClass("last")),j.parents("ul:eq(0)").children("li:last").addClass("last");break;case"inside":if(j.parent().children("ul:first").size())if("top"==this.settings.rules.createat){j.parent().children("ul:first").prepend(c.removeClass("last")).children("li:last").addClass("last");var p=j.parent().children("ul:first").children("li:first");p.size()&&(e="before",d=p)}else{var p=j.parent().children("ul:first").children(".last");p.size()&&(e="after",d=p),j.parent().children("ul:first").children(".last").removeClass("last").end().append(c.removeClass("last")).children("li:last").addClass("last")
}else c.addClass("last"),j.parent().removeClass("leaf").append("<ul/>"),j.parent().hasClass("open")||j.parent().addClass("closed"),j.parent().children("ul:first").prepend(c);j.parent().hasClass("closed")&&this.open_branch(j)}if(0==i.find("li").size()){var q=i.parent();q.removeClass("open").removeClass("closed").addClass("leaf"),q.is(".tree")||q.children("ul").remove(),q.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last")}else i.children("li.last").removeClass("last"),i.children("li:last").addClass("last");return g?this.callback("oncopy",[this.get_node(c).get(0),this.get_node(d).get(0),e,this,h]):f?this.callback("oncreate",[this.get_node(c).get(0),j.is("ul")?-1:this.get_node(d).get(0),e,this,h]):this.callback("onmove",[this.get_node(c).get(0),this.get_node(d).get(0),e,this,h]),c},error:function(a){return this.callback("error",[a,this]),!1},lock:function(a){this.locked=a,this.locked?this.container.children("ul:eq(0)").addClass("locked"):this.container.children("ul:eq(0)").removeClass("locked")},cut:function(a){return this.locked?this.error("LOCKED"):(a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent(),a&&a.size()?(b.cut_copy.copy_nodes=!1,b.cut_copy.cut_nodes=a,void 0):this.error("CUT: NO NODE SELECTED"))},copy:function(a){return this.locked?this.error("LOCKED"):(a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent(),a&&a.size()?(b.cut_copy.copy_nodes=a,b.cut_copy.cut_nodes=!1,void 0):this.error("COPY: NO NODE SELECTED"))},paste:function(a,c){if(this.locked)return this.error("LOCKED");var d=!1;if(-1==a?(d=!0,a=this.container):a=a?this.get_node(a):this.selected,!(d||a&&a.size()))return this.error("PASTE: NO NODE SELECTED");if(!b.cut_copy.copy_nodes&&!b.cut_copy.cut_nodes)return this.error("PASTE: NOTHING TO DO");var f=c;if("before"==c?(c=a.parent().children().index(a),a=a.parents("li:eq(0)")):"after"==c?(c=a.parent().children().index(a)+1,a=a.parents("li:eq(0)")):("undefined"==(typeof c).toLowerCase()||"inside"==c)&&(c="top"==this.settings.rules.createat?0:a.children("ul:eq(0)").children("li").size()),d||0!=a.size()||(d=!0,a=this.container),b.cut_copy.copy_nodes&&b.cut_copy.copy_nodes.size()){var g=!0;if(!d&&!this.check_move(b.cut_copy.copy_nodes,a.children("a:eq(0)"),"inside"))return!1;0==a.children("ul").size()||1==d&&0==a.children("ul").children("li").size()?d?this.moved(b.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",!1,!0):this.moved(b.cut_copy.copy_nodes,a.children("a:eq(0)"),"inside",!1,!0):"before"==f&&a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()?this.moved(b.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before",!1,!0):"after"==f&&a.children("ul:eq(0)").children("li:nth-child("+c+")").size()?this.moved(b.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+c+")").children("a:eq(0)"),"after",!1,!0):a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()?this.moved(b.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before",!1,!0):this.moved(b.cut_copy.copy_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!1,!0),b.cut_copy.copy_nodes=!1}if(b.cut_copy.cut_nodes&&b.cut_copy.cut_nodes.size()){var g=!0;if(a.parents().andSelf().each(function(){return-1!=b.cut_copy.cut_nodes.index(this)?(g=!1,!1):void 0}),!g)return this.error("Invalid paste");if(!d&&!this.check_move(b.cut_copy.cut_nodes,a.children("a:eq(0)"),"inside"))return!1;0==a.children("ul").size()||1==d&&0==a.children("ul").children("li").size()?d?this.moved(b.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside"):this.moved(b.cut_copy.cut_nodes,a.children("a:eq(0)"),"inside"):"before"==f&&a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()?this.moved(b.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before"):"after"==f&&a.children("ul:eq(0)").children("li:nth-child("+c+")").size()?this.moved(b.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+c+")").children("a:eq(0)"),"after"):a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()?this.moved(b.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before"):this.moved(b.cut_copy.cut_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after"),b.cut_copy.cut_nodes=!1}},search:function(b,c){var d=this;if((!b||this.srch&&b!=this.srch)&&(this.srch="",this.srch_opn=!1,this.container.find("a.search").removeClass("search")),this.srch=b,b)if(c||(c="contains"),this.settings.data.async)if(this.srch_opn)if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){for(var f=!1,g=0;g<this.srch_opn.length;g++)if(this.get_node("#"+this.srch_opn[g]).size()>0){f=!0;var h="#"+this.srch_opn[g];delete this.srch_opn[g],this.open_branch(h,!0,function(){d.search.apply(d,[b,c])})}f||(this.srch_opn=[],d.search.apply(d,[b,c]))}}else{this.srch_opn=!1;var i="a";this.settings.languages.length&&(i+="."+this.current_lang),this.callback("onsearch",[this.container.find(i+":"+c+"('"+b+"')"),this])}else{var e=a.extend({search:b},this.callback("beforedata",[!1,this]));a.ajax({type:this.settings.data.opts.method,url:this.settings.data.opts.url,data:e,dataType:"text",success:function(e){d.srch_opn=a.unique(e.split(",")),d.search.apply(d,[b,c])}})}else{var i="a";this.settings.languages.length&&(i+="."+this.current_lang);var j=this.container.find(i+":"+c+"('"+b+"')");j.parents("li.closed").each(function(){d.open_branch(this,!0)}),this.callback("onsearch",[j,this])}},add_sheet:b.add_sheet,destroy:function(){if(this.callback("ondestroy",[this]),this.container.unbind(".jstree"),a("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree"),this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search"),this.cntr==b.focused)for(var c in b.inst)if(c!=this.cntr&&c!=this.container.attr("id")){b.inst[c].focus();break}b.inst[this.cntr]=!1,b.inst[this.container.attr("id")]=!1,delete b.inst[this.cntr],delete b.inst[this.container.attr("id")],b.cntr--}}}a.tree={datastores:{},plugins:{},defaults:{data:{async:!1,type:"html",opts:{method:"GET",url:!1}},selected:!1,opened:[],languages:[],ui:{dots:!0,animation:0,scroll_spd:4,theme_path:!1,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{"default":{clickable:!0,renameable:!0,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:!1,position:!1}}},rules:{multiple:!1,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:!0,use_max_depth:!0,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(){return!0},beforeopen:function(){return!0},beforeclose:function(){return!0},beforemove:function(){return!0},beforecreate:function(){return!0},beforerename:function(){return!0},beforedelete:function(){return!0},beforedata:function(b){return{id:a(b).attr("id")||0}},ondata:function(a){return a},onparse:function(a){return a},onhover:function(){},onselect:function(){},ondeselect:function(){},onchange:function(){},onrename:function(){},onmove:function(){},oncopy:function(){},oncreate:function(){},ondelete:function(){},onopen:function(){},onopen_all:function(){},onclose_all:function(){},onclose:function(){},error:function(){},ondblclk:function(a,b){b.toggle_branch.call(b,a),b.select_branch.call(b,a)},onrgtclk:function(){},onload:function(){},oninit:function(){},onfocus:function(){},ondestroy:function(){},onsearch:function(a){a.addClass("search")},ondrop:function(){},check:function(a,b,c){return c},check_move:function(){return!0}},plugins:{}},create:function(){return new b},focused:function(){return b.inst[b.focused]},reference:function(c){var d=a(c);return d.size()||(d=a("#"+c)),d.size()?(d=d.is(".tree")?d.attr("id"):d.parents(".tree:eq(0)").attr("id"),b.inst[d]||null):null},rollback:function(c){for(var d in c)if(c.hasOwnProperty(d)){var e=b.inst[d],f=!e.locked;f&&e.lock(!0),e.inp=!1,e.container.html(c[d].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover"),c[d].selected&&(e.selected=a("#"+c[d].selected),e.selected_arr=[],e.container.find("a.clicked").each(function(){e.selected_arr.push(e.get_node(this))})),f&&e.lock(!1),delete f,delete e}},drop_mode:function(c){c=a.extend(c,{show:!1,type:"default",str:"Foreign node"}),b.drag_drop.foreign=!0,b.drag_drop.isdown=!0,b.drag_drop.moving=!0,b.drag_drop.appended=!1,b.drag_drop.f_type=c.type,b.drag_drop.f_data=c,c.show?(b.drag_drop.drag_help=a("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+c.str+"</a></li></ul></div>"),b.drag_drop.drag_node=b.drag_drop.drag_help.find("li:eq(0)")):(b.drag_drop.drag_help=!1,b.drag_drop.drag_node=!1),a.tree.drag_start!==!1&&a.tree.drag_start.call(null,!1)},drag_start:!1,drag:!1,drag_end:!1},a.fn.tree=function(c){return this.each(function(){var d=a.extend({},c);b.inst&&b.inst[a(this).attr("id")]&&b.inst[a(this).attr("id")].destroy(),d!==!1&&(new b).init(this,d)})},b.cntr=0,b.inst={},b.themes=[],b.drag_drop={isdown:!1,drag_node:!1,drag_help:!1,dragged:!1,init_x:!1,init_y:!1,moving:!1,origin_tree:!1,marker:!1,move_type:!1,ref_node:!1,appended:!1,foreign:!1,droppable:[],open_time:!1,scroll_time:!1},b.mouseup=function(c){var d=b.drag_drop;if(d.open_time&&clearTimeout(d.open_time),d.scroll_time&&clearTimeout(d.scroll_time),d.moving&&a.tree.drag_end!==!1&&a.tree.drag_end.call(null,c,d),d.foreign===!1&&d.drag_node&&d.drag_node.size()){if(d.drag_help.remove(),d.move_type){var e=b.inst[d.ref_node.parents(".tree:eq(0)").attr("id")];e&&e.moved(d.dragged,d.ref_node,d.move_type,!1,"on"==d.origin_tree.settings.rules.drag_copy||"ctrl"==d.origin_tree.settings.rules.drag_copy&&(c.ctrlKey||c.altKey))}d.move_type=!1,d.ref_node=!1}if(d.foreign!==!1){if(d.drag_help&&d.drag_help.remove(),d.move_type){var e=b.inst[d.ref_node.parents(".tree:eq(0)").attr("id")];e&&e.callback("ondrop",[d.f_data,e.get_node(d.ref_node).get(0),d.move_type,e])}d.foreign=!1,d.move_type=!1,d.ref_node=!1}return b.drag_drop.marker&&b.drag_drop.marker.hide(),d.dragged&&d.dragged.size()&&d.dragged.removeClass("dragged"),d.dragged=!1,d.drag_help=!1,d.drag_node=!1,d.f_type=!1,d.f_data=!1,d.init_x=!1,d.init_y=!1,d.moving=!1,d.appended=!1,d.origin_tree=!1,d.isdown?(d.isdown=!1,c.preventDefault(),c.stopPropagation(),!1):void 0},b.mousemove=function(c){var d=b.drag_drop,e=!1;if(d.isdown){if(!d.moving&&Math.abs(d.init_x-c.pageX)<5&&Math.abs(d.init_y-c.pageY)<5)return c.preventDefault(),c.stopPropagation(),!1;if(d.moving||(b.drag_drop.moving=!0,e=!0),d.open_time&&clearTimeout(d.open_time),d.drag_help!==!1&&(d.appended||(d.foreign!==!1&&(d.origin_tree=a.tree.focused()),a("body").append(d.drag_help),d.w=d.drag_help.width(),d.appended=!0),d.drag_help.css({left:c.pageX+5,top:c.pageY+15})),e&&a.tree.drag_start!==!1&&a.tree.drag_start.call(null,c,d),a.tree.drag!==!1&&a.tree.drag.call(null,c,d),"DIV"==c.target.tagName&&"jstree-marker"==c.target.id)return!1;var f=a(c.target);f.is("ins")&&(f=f.parent());var g=f.is(".tree")?f:f.parents(".tree:eq(0)");if(0==g.size()||!b.inst[g.attr("id")])return d.scroll_time&&clearTimeout(d.scroll_time),d.drag_help!==!1&&d.drag_help.find("li:eq(0) ins").addClass("forbidden"),d.move_type=!1,d.ref_node=!1,b.drag_drop.marker.hide(),!1;var h=b.inst[g.attr("id")];h.off_height(),d.scroll_time&&clearTimeout(d.scroll_time),d.scroll_time=setTimeout(function(){h.scroll_check(c.pageX,c.pageY)},50);var i=!1;if(g.scrollTop(),"A"==c.target.tagName||"INS"==c.target.tagName){if(f.is("#jstree-dragged"))return!1;h.get_node(c.target).hasClass("closed")&&(d.open_time=setTimeout(function(){h.open_branch(f)},500));var k=f.offset(),l={x:k.left-1,y:c.pageY-k.top},m=[];m=l.y<h.li_height/3+1?["before","inside","after"]:l.y>2*h.li_height/3-1?["after","inside","before"]:l.y<h.li_height/2?["inside","before","after"]:["inside","after","before"];var n=!1,o=0==d.foreign?d.origin_tree.container.find("li.dragged"):d.f_type;if(a.each(m,function(a,b){return h.check_move(o,f,b)?(i=b,n=!0,!1):void 0}),n){switch(i){case"before":l.y=k.top-2,b.drag_drop.marker.attr("class","marker");break;case"after":l.y=k.top-2+h.li_height,b.drag_drop.marker.attr("class","marker");break;case"inside":l.x-=2,l.y=k.top-2+h.li_height/2,b.drag_drop.marker.attr("class","marker_plus")}d.move_type=i,d.ref_node=a(c.target),d.drag_help!==!1&&d.drag_help.find(".forbidden").removeClass("forbidden"),b.drag_drop.marker.css({left:l.x,top:l.y}).show()}}if((f.is(".tree")||f.is("ul"))&&0==f.find("li:eq(0)").size()){var k=f.offset();d.move_type="inside",d.ref_node=g.children("ul:eq(0)"),d.drag_help!==!1&&d.drag_help.find(".forbidden").removeClass("forbidden"),b.drag_drop.marker.attr("class","marker_plus"),b.drag_drop.marker.css({left:k.left+10,top:k.top+15}).show()}else("A"!=c.target.tagName&&"INS"!=c.target.tagName||!n)&&(d.drag_help!==!1&&d.drag_help.find("li:eq(0) ins").addClass("forbidden"),d.move_type=!1,d.ref_node=!1,b.drag_drop.marker.hide());return c.preventDefault(),c.stopPropagation(),!1}return!0},a(function(){a(document).bind("mousemove.jstree",b.mousemove),a(document).bind("mouseup.jstree",b.mouseup)}),b.cut_copy={copy_nodes:!1,cut_nodes:!1},b.css=!1,b.get_css=function(a,c){a=a.toLowerCase();var d=b.css.cssRules||b.css.rules,e=0;do{if(d.length&&e>d.length+5)return!1;if(d[e].selectorText&&d[e].selectorText.toLowerCase()==a)return 1==c?(b.css.removeRule&&document.styleSheets[i].removeRule(e),b.css.deleteRule&&document.styleSheets[i].deleteRule(e),!0):d[e]}while(d[++e]);return!1},b.add_css=function(a){return b.get_css(a)?!1:(b.css.insertRule?b.css.insertRule(a+" { }",0):b.css.addRule(a,null,0),b.get_css(a))},b.remove_css=function(a){return b.get_css(a,!0)},b.add_sheet=function(a){if(a.str){var b=document.createElement("style");return b.setAttribute("type","text/css"),b.styleSheet?(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet.cssText=a.str):(b.appendChild(document.createTextNode(a.str)),document.getElementsByTagName("head")[0].appendChild(b)),b.sheet||b.styleSheet}if(a.url){if(!document.createStyleSheet){var d=document.createElement("link");return d.rel="stylesheet",d.type="text/css",d.media="all",d.href=a.url,document.getElementsByTagName("head")[0].appendChild(d),d.styleSheet}try{document.createStyleSheet(a.url)}catch(c){}}},a(function(){var c=navigator.userAgent.toLowerCase();(c.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1];var e='/* TREE LAYOUT */ .tree ul { margin:0 0 0 5px; padding:0 0 0 0; list-style-type:none; } .tree li { display:block; min-height:18px; line-height:18px; padding:0 0 0 15px; margin:0 0 0 0; /* Background fix */ clear:both; } .tree li ul { display:none; } .tree li a, .tree li span { display:inline-block;line-height:16px;height:16px;color:black;white-space:nowrap;text-decoration:none;padding:1px 4px 1px 4px;margin:0; } .tree li a:focus { outline: none; } .tree li a input, .tree li span input { margin:0;padding:0 0;display:inline-block;height:12px !important;border:1px solid white;background:white;font-size:10px;font-family:Verdana; } .tree li a input:not([class="xxx"]), .tree li span input:not([class="xxx"]) { padding:1px 0; } /* FOR DOTS */ .tree .ltr li.last { float:left; } .tree > ul li.last { overflow:visible; } /* OPEN OR CLOSE */ .tree li.open ul { display:block; } .tree li.closed ul { display:none !important; } /* FOR DRAGGING */ #jstree-dragged { position:absolute; top:-10px; left:-10px; margin:0; padding:0; } #jstree-dragged ul ul ul { display:none; } #jstree-marker { padding:0; margin:0; line-height:5px; font-size:1px; overflow:hidden; height:5px; position:absolute; left:-45px; top:-30px; z-index:1000; background-color:transparent; background-repeat:no-repeat; display:none; } #jstree-marker.marker { width:45px; background-position:-32px top; } #jstree-marker.marker_plus { width:5px; background-position:right top; } /* BACKGROUND DOTS */ .tree li li { overflow:hidden; } .tree > .ltr > li { display:table; } /* ICONS */ .tree ul ins { display:inline-block; text-decoration:none; width:16px; height:16px; } .tree .ltr ins { margin:0 4px 0 0px; } ';a.browser.msie&&(6==a.browser.version&&(e+='.tree li { height:18px; zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px; background-position:-32px top; } .marker_plus { width:5px; background-position:right top; }'),7==a.browser.version&&(e+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }')),a.browser.opera&&(e+='.tree > ul > li.last:after { content:"."; display: block; height:1px; clear:both; visibility:hidden; }'),a.browser.mozilla&&0==a.browser.version.indexOf("1.8")&&(e+=".tree .ltr li a { display:inline; float:left; } .tree li ul { clear:both; }"),b.css=b.add_sheet({str:e})})}(apex.jQuery),function(a){a.extend(a.tree.datastores,{html:function(){return{get:function(b,c){return b&&a(b).size()?a("<div>").append(c.get_node(b).clone()).html():c.container.children("ul:eq(0)").html()},parse:function(a,b,c,d){return d&&d.call(null,a),a},load:function(b,c,d,e){d.url?a.ajax({type:d.method,url:d.url,data:b,dataType:"html",success:function(a){e.call(null,a)},error:function(a,b,d){e.call(null,!1),c.error(d+" "+b)}}):e.call(null,d["static"]||c.container.children("ul:eq(0)").html())}}},json:function(){return{get:function(b,c,d){var e=this;if(b=b&&0!=a(b).size()?a(b):c.container.children("ul").children("li"),d||(d={}),d.outer_attrib||(d.outer_attrib=["id","rel","class"]),d.inner_attrib||(d.inner_attrib=[]),b.size()>1){var f=[];return b.each(function(){f.push(e.get(this,c,d))}),f}if(0==b.size())return[];var g={attributes:{},data:{}};b.hasClass("open")&&(g.data.state="open"),b.hasClass("closed")&&(g.data.state="closed");for(var h in d.outer_attrib)if(d.outer_attrib.hasOwnProperty(h)){var i="class"==d.outer_attrib[h]?b.attr(d.outer_attrib[h]).replace(/(^| )last( |$)/gi," ").replace(/(^| )(leaf|closed|open)( |$)/gi," "):b.attr(d.outer_attrib[h]);"undefined"!=typeof i&&i.toString().replace(" ","").length>0&&(g.attributes[d.outer_attrib[h]]=i),delete i}if(c.settings.languages.length){for(var h in c.settings.languages)if(c.settings.languages.hasOwnProperty(h)){var j=b.children("a."+c.settings.languages[h]);if(d.force||d.inner_attrib.length||j.children("ins").get(0).style.backgroundImage.toString().length||j.children("ins").get(0).className.length){if(g.data[c.settings.languages[h]]={},g.data[c.settings.languages[h]].title=c.get_text(b,c.settings.languages[h]),j.children("ins").get(0).style.className.length&&(g.data[c.settings.languages[h]].icon=j.children("ins").get(0).style.className),j.children("ins").get(0).style.backgroundImage.length&&(g.data[c.settings.languages[h]].icon=j.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),d.inner_attrib.length){g.data[c.settings.languages[h]].attributes={};for(var k in d.inner_attrib)if(d.inner_attrib.hasOwnProperty(k)){var i=j.attr(d.inner_attrib[k]);"undefined"!=typeof i&&i.toString().replace(" ","").length>0&&(g.data[c.settings.languages[h]].attributes[d.inner_attrib[k]]=i),delete i}}}else g.data[c.settings.languages[h]]=c.get_text(b,c.settings.languages[h])}}else{var j=b.children("a");if(g.data.title=c.get_text(b),j.children("ins").size()&&j.children("ins").get(0).className.length&&(g.data.icon=j.children("ins").get(0).className),j.children("ins").size()&&j.children("ins").get(0).style.backgroundImage.length&&(g.data.icon=j.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),d.inner_attrib.length){g.data.attributes={};for(var k in d.inner_attrib)if(d.inner_attrib.hasOwnProperty(k)){var i=j.attr(d.inner_attrib[k]);"undefined"!=typeof i&&i.toString().replace(" ","").length>0&&(g.data.attributes[d.inner_attrib[k]]=i),delete i}}}return b.children("ul").size()>0&&(g.children=[],b.children("ul").children("li").each(function(){g.children.push(e.get(this,c,d))})),g},parse:function(a,b,c,d){if("[object Array]"===Object.prototype.toString.apply(a)){for(var e="",f=0;f<a.length;f++)"function"!=typeof a[f]&&(e+=this.parse(a[f],b,c));return d&&d.call(null,e),e}if(!a||!a.data)return d&&d.call(null,!1),"";var e="";e+="<li ";var g=!1;if(a.attributes)for(var f in a.attributes)a.attributes.hasOwnProperty(f)&&("class"==f?(e+=" class='"+a.attributes[f]+" ",("closed"==a.state||"open"==a.state)&&(e+=" "+a.state+" "),e+="' ",g=!0):e+=" "+f+"='"+a.attributes[f]+"' ");if(g||"closed"!=a.state&&"open"!=a.state||(e+=" class='"+a.state+"' "),e+=">",b.settings.languages.length)for(var f=0;f<b.settings.languages.length;f++){var h={};if(h.href="",h.style="",h["class"]=b.settings.languages[f],a.data[b.settings.languages[f]]&&"undefined"!=(typeof a.data[b.settings.languages[f]].attributes).toLowerCase())for(var i in a.data[b.settings.languages[f]].attributes)a.data[b.settings.languages[f]].attributes.hasOwnProperty(i)&&("style"==i||"class"==i?h[i]+=" "+a.data[b.settings.languages[f]].attributes[i]:h[i]=a.data[b.settings.languages[f]].attributes[i]);e+="<a";for(var i in h)h.hasOwnProperty(i)&&(e+=" "+i+'="'+h[i]+'" ');e+=">",e+=a.data[b.settings.languages[f]]&&a.data[b.settings.languages[f]].icon?"<ins style='background-image:url(\""+a.data[b.settings.languages[f]].icon+"\");'>&nbsp;</ins>":"<ins>&nbsp;</ins>",e+=("undefined"!=(typeof a.data[b.settings.languages[f]].title).toLowerCase()?a.data[b.settings.languages[f]].title:a.data[b.settings.languages[f]])+"</a>"}else{var h={};if(h.href="",h.style="",h["class"]="","undefined"!=(typeof a.data.attributes).toLowerCase())for(var f in a.data.attributes)a.data.attributes.hasOwnProperty(f)&&("style"==f||"class"==f?h[f]+=" "+a.data.attributes[f]:h[f]=a.data.attributes[f]);e+="<a";for(var f in h)h.hasOwnProperty(f)&&(e+=" "+f+'="'+h[f]+'" ');e+=">",e+=a.data.icon?"<ins style='background-image:url(\""+a.data.icon+"\");'>&nbsp;</ins>":"<ins>&nbsp;</ins>",e+=("undefined"!=(typeof a.data.title).toLowerCase()?a.data.title:a.data)+"</a>"}if(a.children&&a.children.length){e+="<ul>";for(var f=0;f<a.children.length;f++)e+=this.parse(a.children[f],b,c);e+="</ul>"}return e+="</li>",d&&d.call(null,e),e},load:function(b,c,d,e){var f=d["static"];f?(a.isFunction(f)&&(f=f.call()),e.call(null,f)):a.ajax({type:d.method,url:d.url,data:b,dataType:"json",success:function(a){e.call(null,a)},error:function(a,b,d){e.call(null,!1),c.error(d+" "+b)}})}}}})}(apex.jQuery),function(a){a.extend(a.tree.plugins,{contextmenu:{object:a("<ul id='jstree-contextmenu' class='tree-context' />"),data:{t:!1,a:!1,r:!1},defaults:{class_name:"hover",items:{create:{label:"Create",icon:"create",visible:function(a,b){return 1!=a.length?0:b.check("creatable",a)},action:function(a,b){b.create(!1,b.get_node(a[0]))},separator_after:!0},rename:{label:"Rename",icon:"rename",visible:function(a,b){return 1!=a.length?!1:b.check("renameable",a)},action:function(a,b){b.rename(a)}},remove:{label:"Delete",icon:"remove",visible:function(b,c){var d=!0;return a.each(b,function(){return 0==c.check("deletable",this)&&(d=!1),!1}),d},action:function(b,c){a.each(b,function(){c.remove(this)})}}}},show:function(b,c){var d=a.extend(!0,{},a.tree.plugins.contextmenu.defaults,c.settings.plugins.contextmenu);b=a(b),a.tree.plugins.contextmenu.object.empty();var e="",f=0;for(var g in d.items)if(d.items.hasOwnProperty(g)&&d.items[g]!==!1){var h=1;"object"==typeof d.items[g].visible&&(h=-1==a.inArray(c.get_type(a.tree.plugins.contextmenu.data.a),a.makeArray(d.items[g].visible))?-1:1),"function"==typeof d.items[g].visible&&(h=d.items[g].visible.call(null,a.tree.plugins.contextmenu.data.a,c)),-1!=h&&(f++,d.items[g].is_separator===!0?e+="<li class='separator'><span>&nbsp;</span></li>":(d.items[g].separator_before===!0&&(e+="<li class='separator'><span>&nbsp;</span></li>"),e+='<li><a href="#" rel="'+g+'" class="'+g+" "+(0==h?"disabled":"")+'">',e+=d.items[g].icon?"<ins "+(-1==d.items[g].icon.indexOf("/")?" class='"+d.items[g].icon+"' ":" style='background-image:url(\""+d.items[g].icon+"\");' ")+">&nbsp;</ins>":"<ins>&nbsp;</ins>",e+="<span>"+d.items[g].label+"</span></a></li>",d.items[g].separator_after===!0&&(e+="<li class='separator'><span>&nbsp;</span></li>")))}var i=b.children("a:visible").offset();a.tree.plugins.contextmenu.object.attr("class","tree-context tree-"+c.settings.ui.theme_name.toString()+"-context").html(e);var j=a.tree.plugins.contextmenu.object.height(),k=a.tree.plugins.contextmenu.object.width(),l=i.left,m=i.top+parseInt(b.children("a:visible").height())+2,n=a(window).height()+a(window).scrollTop(),o=a(window).width()+a(window).scrollLeft();m+j>n&&(m=Math.max(n-j-2,0)),l+k>o&&(l=Math.max(o-k-2,0)),a.tree.plugins.contextmenu.object.css({left:l,top:m}).fadeIn("fast")},hide:function(){if(a.tree.plugins.contextmenu.data.t){var b=a.extend(!0,{},a.tree.plugins.contextmenu.defaults,a.tree.plugins.contextmenu.data.t.settings.plugins.contextmenu);a.tree.plugins.contextmenu.data.r&&a.tree.plugins.contextmenu.data.a&&a.tree.plugins.contextmenu.data.a.children("a, span").removeClass(b.class_name),a.tree.plugins.contextmenu.data={a:!1,r:!1,t:!1},a.tree.plugins.contextmenu.object.fadeOut("fast")}},exec:function(b){if(0!=a.tree.plugins.contextmenu.data.t){var c=a.extend(!0,{},a.tree.plugins.contextmenu.defaults,a.tree.plugins.contextmenu.data.t.settings.plugins.contextmenu);try{c.items[b].action.apply(null,[a.tree.plugins.contextmenu.data.a,a.tree.plugins.contextmenu.data.t])}catch(d){}}},callbacks:{oninit:function(){if(!a.tree.plugins.contextmenu.css){var b="#jstree-contextmenu { display:none; position:absolute; z-index:2000; list-style-type:none; margin:0; padding:0; left:-2000px; top:-2000px; } .tree-context { margin:20px; padding:0; width:180px; border:1px solid #979797; padding:2px; background:#f5f5f5; list-style-type:none; }.tree-context li { height:22px; margin:0 0 0 27px; padding:0; background:#ffffff; border-left:1px solid #e0e0e0; }.tree-context li a { position:relative; display:block; height:22px; line-height:22px; margin:0 0 0 -28px; text-decoration:none; color:black; padding:0; }.tree-context li a ins { text-decoration:none; float:left; width:16px; height:16px; margin:0 0 0 0; background-color:#f0f0f0; border:1px solid #f0f0f0; border-width:3px 5px 3px 6px; line-height:16px; }.tree-context li a span { display:block; background:#f0f0f0; margin:0 0 0 29px; padding-left:5px; }.tree-context li.separator { background:#f0f0f0; height:2px; line-height:2px; font-size:1px; border:0; margin:0; padding:0; }.tree-context li.separator span { display:block; margin:0px 0 0px 27px; height:1px; border-top:1px solid #e0e0e0; border-left:1px solid #e0e0e0; line-height:1px; font-size:1px; background:white; }.tree-context li a:hover { border:1px solid #d8f0fa; height:20px; line-height:20px; }.tree-context li a:hover span { background:#e7f4f9; margin-left:28px; }.tree-context li a:hover ins { background-color:#e7f4f9; border-color:#e7f4f9; border-width:2px 5px 2px 5px; }.tree-context li a.disabled { color:gray; }.tree-context li a.disabled ins { }.tree-context li a.disabled:hover { border:0; height:22px; line-height:22px; }.tree-context li a.disabled:hover span { background:#f0f0f0; margin-left:29px; }.tree-context li a.disabled:hover ins { border-color:#f0f0f0; background-color:#f0f0f0; border-width:3px 5px 3px 6px; }";a.tree.plugins.contextmenu.css=this.add_sheet({str:b})}},onrgtclk:function(b,c,d){var e=a.extend(!0,{},a.tree.plugins.contextmenu.defaults,c.settings.plugins.contextmenu);b=a(b),0!=b.size()&&(a.tree.plugins.contextmenu.data.t=c,b.children("a:eq(0)").hasClass("clicked")?(a.tree.plugins.contextmenu.data.r=!1,a.tree.plugins.contextmenu.data.a=c.selected_arr&&c.selected_arr.length>1?c.selected_arr:c.selected):(a.tree.plugins.contextmenu.data.a=b,a.tree.plugins.contextmenu.data.r=!0,b.children("a").addClass(e.class_name),d.target.blur()),a.tree.plugins.contextmenu.show(b,c),d.preventDefault(),d.stopPropagation())},onchange:function(){a.tree.plugins.contextmenu.hide()},beforedata:function(){a.tree.plugins.contextmenu.hide()},ondestroy:function(){a.tree.plugins.contextmenu.hide()}}}}),a(function(){a.tree.plugins.contextmenu.object.hide().appendTo("body"),a("a",a.tree.plugins.contextmenu.object[0]).live("click",function(b){return a(this).hasClass("disabled")||(a.tree.plugins.contextmenu.exec.apply(null,[a(this).attr("rel")]),a.tree.plugins.contextmenu.hide()),b.stopPropagation(),b.preventDefault(),!1}),a(document).bind("mousedown",function(b){0==a(b.target).parents("#jstree-contextmenu").size()&&a.tree.plugins.contextmenu.hide()})})}(apex.jQuery);