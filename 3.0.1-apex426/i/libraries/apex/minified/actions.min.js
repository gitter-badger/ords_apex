!function(apex,debug,lang,$){"use strict";function makeKeyName(event){var name="",k=mapKeyToName[event.which];return k&&(event.which>=112&&event.which<=123||event.which>=33&&event.which<=46||event.ctrlKey||event.altKey||event.metaKey)?(event.ctrlKey&&(name+="Ctrl+"),event.altKey&&(name+="Alt+"),event.metaKey&&(name+="Meta+"),event.shiftKey&&(name+="Shift+"),name+=k):null}function getActionLabel(action){var label=action.label;return!label&&action.onLabel&&action.offLabel?label=action.onLabel+"/"+action.offLabel:action.set&&action.get&&(label=lang.formatMessage("APEX.ACTIONS.TOGGLE",label)),label}var SEL_ACTION_BUTTON="button.js-actionButton",A_LABEL="aria-label",mapKeyToName={6:"Help",8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"Keypad 0",97:"Keypad 1",98:"Keypad 2",99:"Keypad 3",100:"Keypad 4",101:"Keypad 5",102:"Keypad 6",103:"Keypad 7",104:"Keypad 8",105:"Keypad 9",106:"Keypad *",107:"Keypad +",109:"Keypad -",110:"Keypad .",111:"Keypad /",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",188:"Comma",190:"Period",191:"/",192:"`",219:"[",220:"\\",221:"]"},isMac=navigator.appVersion.indexOf("Mac")>=0,actions=function(){function notifyObservers(action,operation){var i,callback;for(i=0;i<observers.length;i++)(callback=observers[i])(action,operation)}var actionMap={},actionShortcut={},shortcutMap={},observers=[],shortcutsDisabled=!1;return{add:function(actions){var i,a,status=!0;for($.isArray(actions)||(actions=[actions]),i=0;i<actions.length;i++)a=actions[i],a.name&&(actionMap[a.name]?(debug.warn("Duplicate action '"+a.name+"' ignored."),status=!1):(actionMap[a.name]=a,a.shortcut&&(this.isValidShortcut(a.shortcut)?shortcutMap[a.shortcut]?(debug.warn("Duplicate shortcut '"+a.shortcut+"' for action '"+a.name+"' ignored."),a.shortcut=null,status=!1):(actionShortcut[a.name]=a.shortcut,shortcutMap[a.shortcut]=a.name):(debug.warn("Invalid shortcut '"+a.shortcut+"' for action '"+a.name+"' ignored."),a.shortcut=null,status=!1)),notifyObservers(a,"add")));return status},addFromMarkup:function(el$){var self=this;el$.children("ul").children("li").each(function(){var action,icon,index,title=null,$item=$(this),a$=$item.children("a").eq(0),span$=$item.children("span").eq(0);action={},a$.length>0?(action.label=a$.text(),action.href=a$.attr("href"),title=a$.attr("title")):span$.length>0&&(action.label=span$.text(),title=span$.attr("title")),title&&(action.title=title),action.name=$item.attr("data-id"),"true"!==$item.attr("data-hide")&&("true"===$item.attr("data-disabled")&&(action.disabled=!0),action.shortcut=$item.attr("data-shortcut")||null,icon=$item.attr("data-icon"),icon&&(index=icon.indexOf(" "),index>=0?(action.iconType=icon.substring(0,index),action.icon=icon.substring(index+1)):action.icon=icon),action.name&&action.label&&"separator"!==action.href&&self.add(action),$item.children("ul").length>0&&self.addFromMarkup($item))})},remove:function(actions){var i,a,name,shortcut;for($.isArray(actions)||(actions=[actions]),i=0;i<actions.length;i++)a=actions[i],name="string"==typeof a?a:a.name,name&&actionMap[name]&&(a=actionMap[name],shortcut=actionMap[name].shortcut,shortcut&&delete shortcutMap[shortcut],delete actionMap[name],delete actionShortcut[name],notifyObservers(a,"remove"))},clear:function(){var name,a;for(name in actionMap)a=actionMap[name],notifyObservers(a,"remove");actionMap={},actionShortcut={},shortcutMap={}},lookup:function(actionName){return actionMap[actionName]},list:function(){var actionName,action,label,actions=[];for(actionName in actionMap)action=actionMap[actionName],label=getActionLabel(action),actions.push({name:actionName,label:label});return actions},update:function(actionName){var a=actionMap[actionName],oldShortcut=actionShortcut[actionName],status=!0;return a.shortcut!==oldShortcut&&(delete shortcutMap[oldShortcut],a.shortcut?this.isValidShortcut(a.shortcut)?shortcutMap[a.shortcut]?(debug.warn("Duplicate shortcut '"+a.shortcut+"' for action '"+actionName+"' ignored."),a.shortcut=null,status=!1):(actionShortcut[actionName]=a.shortcut,shortcutMap[a.shortcut]=actionName):(debug.warn("Invalid shortcut '"+a.shortcut+"' for action '"+a.name+"' ignored."),a.shortcut=null,status=!1):delete actionShortcut[actionName]),notifyObservers(a,"update"),status},enable:function(actionName){var a=actionMap[actionName];a.disabled=!1,notifyObservers(a,"update")},disable:function(actionName){var a=actionMap[actionName];a.disabled=!0,notifyObservers(a,"update")},invoke:function(actionName,event,focusElement){var a=actionMap[actionName];return a&&(a.action||a.href)?a.disabled?void 0:a.action?a.action(event,focusElement):(apex.navigation.redirect(a.href),!0):(debug.error("No such action '"+actionName+"' or action can't be invoked."),!1)},toggle:function(actionName){var value,a=actionMap[actionName];return a&&a.get&&a.set?void(a.disabled||(value=!a.get(),a.set(value),actions.update(actionName))):(debug.error("No such action '"+actionName+"' or action cannot be toggled."),!1)},lookupShortcutAction:function(shortcutName){return shortcutsDisabled?void 0:shortcutMap[shortcutName]},addShortcut:function(shortcutName,actionName){return actionMap[actionName]?shortcutMap[shortcutName]?(debug.warn("Duplicate shortcut '"+shortcutName+"' for action '"+actionName+"' ignored."),!1):(shortcutMap[shortcutName]=actionName,!0):(debug.warn("No such action '"+actionName+"'."),!1)},removeShortcut:function(shortcutName){var actionName;return actionName=shortcutMap[shortcutName],actionShortcut[actionName]===shortcutName?(debug.warn("Can't delete primary for action."),!1):(delete shortcutMap[shortcutName],!0)},listShortcuts:function(){var shortcutName,actionName,action,label,shortcuts=[];for(shortcutName in shortcutMap)actionName=shortcutMap[shortcutName],action=actionMap[actionName],label=getActionLabel(action),shortcuts.push({shortcut:shortcutName,shortcutDisplay:this.shortcutDisplay(shortcutName),actionName:actionName,actionLabel:label});return shortcuts},shortcutDisplay:function(shortcut){var i,display="",parts=shortcut.split("+");for(i=0;i<parts.length;i++)i>0&&(display+="+"),display+=isMac?"Alt"===parts[i]?"Option":"Meta"===parts[i]?"âŒ˜":parts[i]:parts[i];return display},enableShortcuts:function(){shortcutsDisabled=!1},disableShortcuts:function(){shortcutsDisabled=!0},observe:function(callback){observers.push(callback)},unobserve:function(callback){var i;for(i=0;i<observers.length;i++)if(observers[i]===callback){observers.splice(i,1);break}},getShortcutFromEvent:function(event){var keyName=makeKeyName(event);return keyName?{shortcut:keyName,shortcutDisplay:this.shortcutDisplay(keyName)}:null},isValidShortcut:function(shortcutName,checkIfUsed){var i,part,nextPos,key,pos=0,valid=!0,parts=shortcutName.split("+");for(i=0;i<parts.length-1;i++){if(part=parts[i],"Ctrl"===part)nextPos=1;else if("Alt"===part)nextPos=2;else if("Meta"===part)nextPos=3;else{if("Shift"!==part){valid=!1;break}nextPos=4}if(pos>=nextPos){valid=!1;break}pos=nextPos}if(valid){part=parts[i],valid=!1;for(key in mapKeyToName)if(mapKeyToName[key]===part){valid=!0;break}valid&&0===pos&&1===part.length&&(valid=!1),valid&&checkIfUsed&&shortcutMap[shortcutName]&&(valid=!1)}return valid}}}();apex.actions=actions;var buttonLabelSelector=".a-Button-label, .t-Button-label",buttonHasIconSelector=".a-Button--withIcon, .t-Button--icon",buttonNoLabelSelector=".a-Button--noLabel, .t-Button--noLabel";actions.observe(function(action,op){var name=action.name,button$=$("[data-action="+name+"]");"remove"!==op?button$.each(function(){var iconType,label,value,title,labelWrapper$,isToggle=!1,b$=$(this);b$.show(),action.get&&(isToggle=!0,value=action.get()),"add"===op&&(null!==action.label||isToggle||(action.label=b$.attr(A_LABEL)?b$.attr(A_LABEL):b$.is(buttonNoLabelSelector)?b$.attr("title"):b$.find(buttonLabelSelector).first().text()||b$.text()),null===action.title&&(action.title=b$.attr("title"),!action.label&&action.title&&(action.label=action.title))),label=action.label,title=action.title,!label&&isToggle&&(label=value?action.onLabel:action.offLabel),b$.is(buttonNoLabelSelector)?(b$.attr(A_LABEL,label),title||(title=label)):(labelWrapper$=b$.find(buttonLabelSelector).first(),labelWrapper$.length?labelWrapper$.text(label):b$.text(label)),title?b$.attr("title",title):b$.removeAttr("title"),action.icon&&b$.is(buttonHasIconSelector)&&(iconType=action.iconType||"a-Icon",b$.find("."+iconType).each(function(){var icon$=$(this),newClasses=[],classes=icon$.attr("class");$.each(classes.split(" "),function(i,c){/^t-/.test(c)&&newClasses.push(c)}),newClasses.push(iconType),newClasses.push(action.icon),icon$.attr("class",newClasses.join(" "))})),isToggle&&!action.onLabel&&b$.toggleClass("is-active",value),this.disabled=!!action.disabled}):button$.hide()}),$(document).ready(function(){function doAction(actionName,event,logPrefix){var action,result,value;try{if(action=actions.lookup(actionName),!action)return void debug.error("No such action '"+actionName+"'.");if(action.disabled)return;if(action.action||action.href){if(debug.info(logPrefix+" invoke action '"+actionName+"'"),result=actions.invoke(actionName,event,event.target),result===!1)return}else action.get&&action.set?(value=!action.get(),debug.info(logPrefix+" invoke toggle action '"+actionName+"' value now "+value),action.set(value),actions.update(actionName)):debug.error("Error action '"+actionName+"' has no action, get, or set methods.")}catch(ex){debug.error("Error in action for '"+actionName+"'.",ex)}result!==!0&&event.target.focus()}$("body").on("click",SEL_ACTION_BUTTON,function(event){var actionName=$(this).attr("data-action");doAction(actionName,event,"Button click")}).on("keydown",function(event){var actionName,keyName=makeKeyName(event);if(keyName){if(("TEXTAREA"===event.target.nodeName||"INPUT"===event.target.nodeName&&"text"===event.target.type.toLowerCase())&&["Ctrl+C","Ctrl+X","Ctrl+V","Ctrl+A","Ctrl+Z","Ctrl+Y"].indexOf(keyName)>=0)return;actionName=actions.lookupShortcutAction(keyName),actionName&&doAction(actionName,event,"Shortcut key")}}).on("dialogopen menubeforeopen",function(){actions.disableShortcuts()}).on("dialogclose menuafterclose",function(){actions.enableShortcuts()})})}(apex,apex.debug,apex.lang,apex.jQuery);