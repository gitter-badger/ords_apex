!function(debug,$){"use strict";function domIndex(el$){return el$.parent().children().index(el$)}function getItemFocusable(item$){var a$=item$.find("a");return a$.length?a$[0]:item$[0]}var C_ICON_LIST="a-IconList",C_LIST_ITEM="a-IconList-item",SEL_LIST_ITEM="."+C_LIST_ITEM,C_SELECTED="is-selected",SEL_SELECTED="."+C_SELECTED,C_FOCUSED="is-focused",C_DISABLED="is-disabled",ARIA_SELECTED="aria-selected",ARIA_MULTI="aria-multiselectable",ARIA_LABELLEDBY="aria-labelledby",C_RTL="u-RTL",keys=$.ui.keyCode,gIdCounter=0;$.widget("apex.iconList",{version:"5.0",widgetEventPrefix:"iconlist",options:{multiple:!1,label:!0,navigation:!1,contextMenuAction:null,contextMenu:null,contextMenuId:null,selectionChange:null,activate:null},columns:0,rows:0,forwardKey:keys.RIGHT,backwardKey:keys.LEFT,searchString:"",searchTimerId:null,_create:function(){var label$,self=this,o=this.options,ctrl$=this.element;if(o.navigation&&(o.multiple=!1),ctrl$.addClass(C_ICON_LIST).attr("role","listbox"),o.multiple&&ctrl$.attr(ARIA_MULTI,"true"),"rtl"===ctrl$.css("direction")&&(ctrl$.addClass(C_RTL),this.forwardKey=keys.LEFT,this.backwardKey=keys.RIGHT),ctrl$.attr(ARIA_LABELLEDBY)?(label$=$("#"+ctrl$.attr(ARIA_LABELLEDBY).split(" ").join(",#")).last(),this.infoId=label$.attr("id")+"_info",label$.append("<span id='"+this.infoId+"' class='u-VisuallyHidden'></span>")):(this.infoId=(ctrl$.attr("id")||"il"+gIdCounter++)+"_info",ctrl$.before("<span id='"+this.infoId+"' class='u-VisuallyHidden'></span>"),ctrl$.attr(ARIA_LABELLEDBY,this.infoId),this.addedLabel=!0),o.contextMenu)if($.apex.menu){if(o.contextMenu.menubar)throw"IconList contextMenu must not be a menubar";o.contextMenu._originalBeforeOpen=o.contextMenu.beforeOpen,o.contextMenu.beforeOpen=function(event,ui){o.contextMenu._originalBeforeOpen&&(ui.menuElement=self.contextMenu$,ui.iconList=ctrl$,ui.selection=self.getSelection(),o.contextMenu._originalBeforeOpen(event,ui))},o.contextMenu._originalAfterClose=o.contextMenu.afterClose,o.contextMenu.afterClose=function(event,ui){o.contextMenu._originalAfterClose&&(ui.menuElement=self.contextMenu$,ui.iconList=ctrl$,o.contextMenu._originalAfterClose(event,ui)),ui.actionTookFocus||self.focus()},this.contextMenu$=$("<div style='display:none'></div>").appendTo("body"),o.contextMenuId&&(this.contextMenu$[0].id=o.contextMenuId),this.contextMenu$.menu(o.contextMenu),o.contextMenuAction&&debug.warn("IconList contextMenuAction option ignored when contextMenu option present"),o.contextMenuAction=function(event){var target$,pos;"contextmenu"===event.type?self.contextMenu$.menu("toggle",event.pageX,event.pageY):(target$=$(event.target),pos=target$.offset(),self.contextMenu$.menu("toggle",pos.left,pos.top+target$.closest("a-IconList-item").outerHeight()))}}else debug.warn("IconList contextMenu option ignored because menu widget not preset");this._on(this._eventHandlers),this.refresh(),o.disabled&&this._setOption("disabled",o.disabled)},_eventHandlers:{resize:function(event){event.target===this.element[0]&&(this._dim(),event.stopPropagation())},click:function(event){var item$;this.options.navigation&&$(event.target).closest("a").length>0&&(event.shiftKey||event.ctrlKey)||(item$=$(event.target).closest(SEL_LIST_ITEM),item$.length&&(this._select(item$,event,!0,!1),this.options.navigation&&this._activate(event),event.preventDefault()))},dblclick:function(event){var item$;this.options.navigation||(item$=$(event.target).closest(SEL_LIST_ITEM),item$.length&&this._activate(event))},mousedown:function(event){event.preventDefault()},keydown:function(event){var pos,items$,index,ctrl$=this.element,next$=null,kc=event.which;kc===keys.HOME?next$=ctrl$.children().first():kc===keys.END?next$=ctrl$.children().last():kc===keys.DOWN?this.lastFocused&&(pos=this._index2RowCol(domIndex($(this.lastFocused).closest(SEL_LIST_ITEM))),items$=ctrl$.children(),pos.row<Math.floor((items$.length-1)/this.columns)&&(index=this._rowCol2Index(pos.row+1,pos.column),index>=items$.length&&(index=items$.length-1),next$=items$.eq(index))):kc===keys.UP?this.lastFocused&&(pos=this._index2RowCol(domIndex($(this.lastFocused).closest(SEL_LIST_ITEM))),items$=ctrl$.children(),index=this._rowCol2Index(pos.row-1,pos.column),index>=0&&(next$=items$.eq(index)),event.stopPropagation()):kc===this.backwardKey?this.lastFocused&&(next$=$(this.lastFocused).closest(SEL_LIST_ITEM).prev(),0===next$.length&&(next$=$(this.lastFocused).closest(SEL_LIST_ITEM))):kc===this.forwardKey?this.lastFocused&&(next$=$(this.lastFocused).closest(SEL_LIST_ITEM).next(),0===next$.length&&(next$=$(this.lastFocused).closest(SEL_LIST_ITEM))):kc===keys.SPACE?this.lastFocused&&!this.searchTimerId&&(next$=$(this.lastFocused).closest(SEL_LIST_ITEM)):kc===keys.ENTER?"A"!==event.target.nodeName&&this._activate(event):this.options.contextMenuAction&&event.shiftKey&&121===kc&&(this.lastFocused&&!$(this.lastFocused).closest(SEL_LIST_ITEM).hasClass(C_SELECTED)&&this._select($(this.lastFocused).closest(SEL_LIST_ITEM),{},!0,!1),this.options.contextMenuAction(event),event.preventDefault()),next$&&(this._select(next$,event,!0,!0),event.preventDefault())},keypress:function(event){var ch,next$,self=this;if(0!==event.which&&this.options.label){if(ch=String.fromCharCode(event.which).toLowerCase(),this.searchTimerId)ch!==this.searchString&&(this.searchString+=ch),clearTimeout(this.searchTimerId),this.searchTimerId=null;else{if(" "===ch)return;this.searchString=ch}this.searchTimerId=setTimeout(function(){self.searchTimerId=null},500),next$=this._findItem(this.searchString),next$&&this._select(next$,{},!0,!0)}},focusin:function(event){var item$=$(event.target).closest(SEL_LIST_ITEM);0!==item$.length&&(item$.addClass(C_FOCUSED),this._setFocusable(event.target))},focusout:function(event){var item$=$(event.target).closest(SEL_LIST_ITEM);item$.removeClass(C_FOCUSED)},contextmenu:function(event){var item$,action=this.options.contextMenuAction;action&&(item$=$(event.target).closest(SEL_LIST_ITEM).not(SEL_SELECTED),item$.length&&this._select(item$,{},!0,!1),action(event),event.preventDefault())}},_destroy:function(){this.element.removeClass(C_ICON_LIST+" "+C_DISABLED+" "+C_RTL).removeAttr("role").removeAttr(ARIA_MULTI).children().removeClass(C_LIST_ITEM).removeAttr("role").removeAttr(ARIA_SELECTED).removeAttr("tabindex"),this.element.find("a").removeAttr("tabindex").removeAttr("role"),this.contextMenu$&&this.contextMenu$.remove(),$("#"+this.infoId).remove(),this.addedLabel&&this.element.removeAttr(ARIA_LABELLEDBY)},_setOption:function(key,value){var o=this.options;if("multiple"===key)o.navigation&&(value=!1);else{if("contextMenu"===key||"contextMenuId"===key)throw"IconList "+key+" cannot be set";if("contextMenuAction"===key&&this.options.contextMenu)throw"IconList contextMenuAction cannot be set when the contextMenu option is used";if("navigation"===key)throw"IconList navigation option cannot be set"}this._super(key,value),"disabled"===key?(this.element.toggleClass(C_DISABLED,value),this.lastFocused&&(value?this.lastFocused.tabIndex=-1:this._setFocusable(this.lastFocused)),value&&this._dim()):"multiple"===key&&(value?this.element.attr(ARIA_MULTI,"true"):this.element.removeAttr(ARIA_MULTI))},refresh:function(){var sel$,o=this.options,ctrl$=this.element;ctrl$.find("a").attr("tabindex",-1).attr("role","option"),ctrl$.children().addClass(C_LIST_ITEM).filter(function(){return 0===$(this).find("a").length}).attr("role","option").attr("tabindex",-1),this._dim(),sel$=ctrl$.find(SEL_SELECTED+SEL_LIST_ITEM),sel$.length>0?this.setSelection(sel$,!1):(this.lastFocused&&$(this.lastFocused).is(":visible")||(this.lastFocused=getItemFocusable(ctrl$.children().first())),this.selectAnchor=this.lastFocused,this.lastFocused&&!o.disabled&&this._setFocusable(this.lastFocused))},focus:function(){this.lastFocused&&this.lastFocused.focus()},getSelection:function(){return this.element.find(SEL_SELECTED)},getSelectionValues:function(){var values=[];return this.element.find(SEL_SELECTED).each(function(){values.push($(this).attr("data-value"))}),values},setSelection:function(items$,focus){focus=!!focus,this._select(items$,null,focus,!1,!0)},_rowCol2Index:function(row,column){return row*this.columns+column},_index2RowCol:function(index){var row=Math.floor(index/this.columns);return{row:Math.floor(index/this.columns),column:index-row*this.columns}},_dim:function(){var y,label,self=this,ctrl$=this.element,length=ctrl$.children().length;length&&(y=ctrl$.children().first().position().top),self.columns=length,ctrl$.children().each(function(index){var top=$(this).position().top;return top>y?(y=top,self.columns=index,!1):void 0}),self.rows=length>0?Math.floor((length+self.columns-1)/self.columns):0,label=apex.lang.formatMessage("APEX.ICON_LIST.GRID_DIM",self.columns,self.rows),$("#"+this.infoId).text(label)},_findItem:function(search){var text,next$,start$,slen=search.length,labelSelector=this.options.label;for(next$=start$=$(this.lastFocused).closest(SEL_LIST_ITEM),1===slen&&(next$=next$.next()),0===next$.length&&(next$=this.element.children().first());next$.length>0;){if(text=labelSelector===!0?next$.text():next$.find(labelSelector).text(),text.substring(0,slen).toLowerCase()===search)return next$;if(next$=next$.next(),0===next$.length&&(next$=this.element.children().first()),next$[0]===start$[0])break}return null},_setFocusable:function(el){this.lastFocused&&this.lastFocused!==el&&(this.lastFocused.tabIndex=-1),el.tabIndex=0,this.lastFocused=el},_activate:function(event){var sel$,href;this._trigger("activate",event,{values:this.getSelectionValues()}),this.options.navigation&&!event.isDefaultPrevented()&&(sel$=this.getSelection(),href=sel$.attr("href")||sel$.find("a").attr("href"),href&&(event.preventDefault(),apex.navigation.redirect(href)))},_select:function(items$,event,focus,delayTrigger,noNotify){var prevSelected,offset,sp,spOffset,glOffset,start,end,temp,toFocus,action="set",self=this,prevSel$=this.element.find(SEL_SELECTED);items$=items$.filter(":visible"),event&&this.options.multiple&&("click"===event.type?event.ctrlKey||event.metaKey?action="toggle":event.shiftKey&&(action="range"):"keydown"===event.type&&(event.keyCode===$.ui.keyCode.SPACE?action=event.ctrlKey?"toggle":event.shiftKey?"range":"add":event.ctrlKey?action="none":event.shiftKey&&(action="range"))),"range"!==action||this.selectAnchor||(action="set"),("set"===action||"range"===action)&&prevSel$.removeClass(C_SELECTED).removeAttr(ARIA_SELECTED),prevSelected=items$.hasClass(C_SELECTED),"set"===action||"add"===action||"toggle"===action&&!prevSelected?(items$.addClass(C_SELECTED).attr(ARIA_SELECTED,!0),this.selectAnchor=items$[0]):"range"===action?(this.element.children().removeClass(C_SELECTED).removeAttr(ARIA_SELECTED),start=domIndex($(this.selectAnchor)),end=domIndex(items$.last()),start>end&&(temp=end,end=start,start=temp),this.element.children().filter(function(index){return index>=start&&end>=index}).addClass(C_SELECTED).attr(ARIA_SELECTED,!0)):"toggle"===action&&prevSelected&&(items$.removeClass(C_SELECTED).removeAttr(ARIA_SELECTED),this.selectAnchor=items$[0]),items$.length>0&&(toFocus=getItemFocusable(items$.first()),focus?(toFocus.tabIndex=0,toFocus.focus()):this._setFocusable(toFocus),sp=this.element.scrollParent(),spOffset=sp.offset(),spOffset&&(glOffset=this.element.offset(),offset=items$.first().offset(),(offset.top<spOffset.top||offset.top>spOffset.top+sp[0].offsetHeight)&&(sp[0].scrollTop=offset.top-glOffset.top),(offset.left+items$[0].offsetWidth<spOffset.left||offset.left>spOffset.left+sp[0].offsetWidth)&&(sp[0].scrollLeft=offset.left-glOffset.left))),noNotify||this.options.navigation&&"click"===event.type||("toggle"===action||"range"===action&&!prevSelected||"add"===action&&!prevSelected||"set"===action&&(prevSel$[0]!==items$[0]||prevSel$.length!==items$.length))&&(self.triggerTimerId&&(clearTimeout(self.triggerTimerId),self.triggerTimerId=null),self.triggerTimerId=setTimeout(function(){self.triggerTimerId=null,self._trigger("selectionChange",event)},delayTrigger?350:1))}})}(apex.debug,apex.jQuery);